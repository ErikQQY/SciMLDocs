<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>GPU-Accelerated Stochastic Partial Differential Equations · Overview of Julia&#39;s SciML</title><meta name="title" content="GPU-Accelerated Stochastic Partial Differential Equations · Overview of Julia&#39;s SciML"/><meta property="og:title" content="GPU-Accelerated Stochastic Partial Differential Equations · Overview of Julia&#39;s SciML"/><meta property="twitter:title" content="GPU-Accelerated Stochastic Partial Differential Equations · Overview of Julia&#39;s SciML"/><meta name="description" content="Documentation for Overview of Julia&#39;s SciML."/><meta property="og:description" content="Documentation for Overview of Julia&#39;s SciML."/><meta property="twitter:description" content="Documentation for Overview of Julia&#39;s SciML."/><meta property="og:url" content="https://docs.sciml.ai/stable/showcase/gpu_spde/"/><meta property="twitter:url" content="https://docs.sciml.ai/stable/showcase/gpu_spde/"/><link rel="canonical" href="https://docs.sciml.ai/stable/showcase/gpu_spde/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Overview of Julia&#39;s SciML logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Overview of Julia&#39;s SciML</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">SciML: Open Source Software for Scientific Machine Learning with Julia</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../getting_started/getting_started/">Getting Started with Julia&#39;s SciML</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">New User Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../getting_started/installation/">Installing SciML Software</a></li><li><a class="tocitem" href="../../getting_started/first_simulation/">Build and run your first simulation with Julia&#39;s SciML</a></li><li><a class="tocitem" href="../../getting_started/first_optimization/">Solve your first optimization problem</a></li><li><a class="tocitem" href="../../getting_started/fit_simulation/">Fit a simulation to a dataset</a></li><li><a class="tocitem" href="../../getting_started/find_root/">Find the root of an equation (i.e. solve f(u)=0)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Comparison With Other Tools</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../comparisons/python/">Getting Started with Julia&#39;s SciML for the Python User</a></li><li><a class="tocitem" href="../../comparisons/matlab/">Getting Started with  Julia&#39;s SciML for the MATLAB User</a></li><li><a class="tocitem" href="../../comparisons/r/">Getting Started with Julia&#39;s SciML for the R User</a></li><li><a class="tocitem" href="../../comparisons/cppfortran/">Getting Started with Julia&#39;s SciML for the C++/Fortran User</a></li></ul></li></ul></li><li><span class="tocitem">Showcase of Cool Examples</span><ul><li><a class="tocitem" href="../showcase/">The SciML Showcase</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Automated Model Discovery</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../missing_physics/">Automatically Discover Missing Physics by Embedding Machine Learning into Differential Equations</a></li><li><a class="tocitem" href="../bayesian_neural_ode/">Uncertainty Quantified Deep Bayesian Model Discovery</a></li><li><a class="tocitem" href="../blackhole/">Discovering the Relativistic Corrections to Binary Black Hole Dynamics</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Solving Difficult Equations Efficiently</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../brusselator/">Automated Efficient Solution of Nonlinear Partial Differential Equations</a></li><li><a class="tocitem" href="../pinngpu/">GPU-Accelerated Physics-Informed Neural Network (PINN) PDE Solvers</a></li><li><a class="tocitem" href="../massively_parallel_gpu/">Massively Data-Parallel ODE Solving on GPUs</a></li><li class="is-active"><a class="tocitem" href>GPU-Accelerated Stochastic Partial Differential Equations</a><ul class="internal"><li><a class="tocitem" href="#Before-we-start:-the-two-ways-to-accelerate-ODE-solvers-with-GPUs"><span>Before we start: the two ways to accelerate ODE solvers with GPUs</span></a></li><li><a class="tocitem" href="#Our-Problem:-2-dimensional-Reaction-Diffusion-Equations"><span>Our Problem: 2-dimensional Reaction-Diffusion Equations</span></a></li><li><a class="tocitem" href="#Discretizing-the-PDE-into-ODEs"><span>Discretizing the PDE into ODEs</span></a></li><li><a class="tocitem" href="#Our-Representation-via-Views-of-3-Tensors"><span>Our Representation via Views of 3-Tensors</span></a></li><li><a class="tocitem" href="#Some-Optimizations"><span>Some Optimizations</span></a></li><li><a class="tocitem" href="#Quick-Note-About-Performance"><span>Quick Note About Performance</span></a></li><li><a class="tocitem" href="#Making-Use-of-GPU-Parallelism"><span>Making Use of GPU Parallelism</span></a></li><li><a class="tocitem" href="#And-Stochastic-PDEs?"><span>And Stochastic PDEs?</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Useful Cool Wonky Things</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ode_types/">Automatic Uncertainty Quantification, Arbitrary Precision, and Unit Checking in ODE Solutions using Julia&#39;s Type System</a></li><li><a class="tocitem" href="../symbolic_analysis/">Symbolic-Numeric Analysis of Parameter Identifiability and Model Stability</a></li><li><a class="tocitem" href="../optimization_under_uncertainty/">Optimization Under Uncertainty</a></li></ul></li></ul></li><li><span class="tocitem">What is SciML?</span><ul><li><a class="tocitem" href="../../overview/">Detailed Overview of the SciML Software Ecosystem</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../highlevels/equation_solvers/">Equation Solvers</a></li><li><a class="tocitem" href="../../highlevels/inverse_problems/">Parameter Estimation, Bayesian Analysis, and Inverse Problems</a></li><li><a class="tocitem" href="../../highlevels/partial_differential_equation_solvers/">Partial Differential Equations (PDE)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Modeling Tools</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../highlevels/modeling_languages/">Modeling Languages</a></li><li><a class="tocitem" href="../../highlevels/model_libraries_and_importers/">Model Libraries and Importers</a></li><li><a class="tocitem" href="../../highlevels/symbolic_tools/">Symbolic Model Tooling and JuliaSymbolics</a></li><li><a class="tocitem" href="../../highlevels/array_libraries/">Modeling Array Libraries</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Simulation Analysis</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../highlevels/parameter_analysis/">Parameter Analysis Utilities</a></li><li><a class="tocitem" href="../../highlevels/uncertainty_quantification/">Uncertainty Quantification</a></li><li><a class="tocitem" href="../../highlevels/plots_visualization/">SciML-Supported Plotting and Visualization Libraries</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Machine Learning</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../highlevels/function_approximation/">Function Approximation</a></li><li><a class="tocitem" href="../../highlevels/implicit_layers/">Implicit Layer Deep Learning</a></li><li><a class="tocitem" href="../../highlevels/symbolic_learning/">Symbolic Learning and Artificial Intelligence</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Developer Tools</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../highlevels/numerical_utilities/">SciML Numerical Utility Libraries</a></li><li><a class="tocitem" href="../../highlevels/interfaces/">The SciML Interface Libraries</a></li><li><a class="tocitem" href="../../highlevels/developer_documentation/">Developer Documentation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Extra Learning Resources</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../highlevels/learning_resources/">Curated Learning, Teaching, and Training Resources</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Showcase of Cool Examples</a></li><li><a class="is-disabled">Solving Difficult Equations Efficiently</a></li><li class="is-active"><a href>GPU-Accelerated Stochastic Partial Differential Equations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>GPU-Accelerated Stochastic Partial Differential Equations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/SciMLDocs" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/SciMLDocs/blob/main/docs/src/showcase/gpu_spde.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="gpuspde"><a class="docs-heading-anchor" href="#gpuspde">GPU-Accelerated Stochastic Partial Differential Equations</a><a id="gpuspde-1"></a><a class="docs-heading-anchor-permalink" href="#gpuspde" title="Permalink"></a></h1><p>Let&#39;s solve stochastic PDEs in Julia using GPU parallelism. To do this, we will use the type-genericness of the DifferentialEquations.jl library in order to write a code that uses within-method GPU-parallelism on the system of PDEs. The OrdinaryDiffEq.jl solvers of DifferentialEquations.jl, including implicit solvers with GMRES, etc., and the same for SDEs, DAEs, DDEs, etc. are all GPU-compatible with a fast form of broadcast.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The non-native Julia solvers, like Sundials are incompatible with arbitrary input types and thus not compatible with GPUs.</p></div></div><p>Let&#39;s dive into showing how to accelerate ODE solving with GPUs!</p><h2 id="Before-we-start:-the-two-ways-to-accelerate-ODE-solvers-with-GPUs"><a class="docs-heading-anchor" href="#Before-we-start:-the-two-ways-to-accelerate-ODE-solvers-with-GPUs">Before we start: the two ways to accelerate ODE solvers with GPUs</a><a id="Before-we-start:-the-two-ways-to-accelerate-ODE-solvers-with-GPUs-1"></a><a class="docs-heading-anchor-permalink" href="#Before-we-start:-the-two-ways-to-accelerate-ODE-solvers-with-GPUs" title="Permalink"></a></h2><p>Before we dive deeper, let us remark that there are two very different ways that one can accelerate an ODE solution with GPUs. There is one case where <code>u</code> is very big and <code>f</code> is very expensive, but very structured, and you use GPUs to accelerate the computation of said <code>f</code>. The other use case is where <code>u</code> is very small but you want to solve the ODE <code>f</code> over many different initial conditions (<code>u0</code>) or parameters <code>p</code>. In that case, you can use GPUs to parallelize over different parameters and initial conditions. In other words:</p><table><tr><th style="text-align: left">Type of Problem</th><th style="text-align: left">SciML Solution</th></tr><tr><td style="text-align: left">Accelerate a big ODE</td><td style="text-align: left">Use <a href="https://cuda.juliagpu.org/stable/">CUDA.jl&#39;s</a> CuArray as <code>u0</code></td></tr><tr><td style="text-align: left">Solve the same ODE with many <code>u0</code> and <code>p</code></td><td style="text-align: left">Use <a href="https://docs.sciml.ai/DiffEqGPU/stable/">DiffEqGPU.jl&#39;s</a> <code>EnsembleGPUArray</code> and <code>EnsembleGPUKernel</code></td></tr></table><p>This showcase will focus on the former case. For the latter, see the <a href="../massively_parallel_gpu/#datagpu">massively parallel GPU ODE solving showcase</a>.</p><h2 id="Our-Problem:-2-dimensional-Reaction-Diffusion-Equations"><a class="docs-heading-anchor" href="#Our-Problem:-2-dimensional-Reaction-Diffusion-Equations">Our Problem: 2-dimensional Reaction-Diffusion Equations</a><a id="Our-Problem:-2-dimensional-Reaction-Diffusion-Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Our-Problem:-2-dimensional-Reaction-Diffusion-Equations" title="Permalink"></a></h2><p>The reaction-diffusion equation is a PDE commonly handled in systems biology, which is a diffusion equation plus a nonlinear reaction term. The dynamics are defined as:</p><p class="math-container">\[u_t = D \Delta u + f(t,u)\]</p><p>But this doesn&#39;t need to only have a single “reactant” u: this can be a vector of reactants and the <span>$f$</span> is then the nonlinear vector equations describing how these different pieces react together. Let&#39;s settle on a specific equation to make this easier to explain. Let&#39;s use a simple model of a 3-component system where A can diffuse through space to bind with the non-diffusive B to form the complex C (also non-diffusive, assume B is too big and gets stuck in a cell which causes C=A+B to be stuck as well). Other than the binding, we make each of these undergo a simple birth-death process, and we write down the equations which result from mass-action kinetics. If this all is meaningless to you, just understand that it gives the system of PDEs:</p><p class="math-container">\[\begin{align}
A_t &amp;= D \Delta A + \alpha_A(x) - \beta_A  A - r_1 A B + r_2 C\\
B_t &amp;= \alpha_B - \beta_B B - r_1 A B + r_2 C\\
C_t &amp;= \alpha_C - \beta_C C + r_1 A B - r_2 C
\end{align}\]</p><p>One addition that was made to the model is that we let <span>$\alpha_A(x)$</span> be the production of <span>$A$</span>, and we let that be a function of space so that way it only is produced on one side of our equation. Let&#39;s make it a constant when x&gt;80, and 0 otherwise, and let our spatial domain be <span>$x \in [0,100]$</span> and <span>$y \in [0,100]$</span>.</p><p>This model is spatial: each reactant <span>$u(t,x,y)$</span> is defined at each point in space, and all of the reactions are local, meaning that <span>$f$</span> at spatial point <span>$(x,y)$</span> only uses <span>$u_i(t,x,y)$</span>. This is an important fact which will come up later for parallelization.</p><h2 id="Discretizing-the-PDE-into-ODEs"><a class="docs-heading-anchor" href="#Discretizing-the-PDE-into-ODEs">Discretizing the PDE into ODEs</a><a id="Discretizing-the-PDE-into-ODEs-1"></a><a class="docs-heading-anchor-permalink" href="#Discretizing-the-PDE-into-ODEs" title="Permalink"></a></h2><p>In order to solve this via a method of lines (MOL) approach, we need to discretize the PDE into a system of ODEs. Let&#39;s do a simple uniformly-spaced grid finite difference discretization. Choose <span>$dx = 1$</span> and <span>$dy = 1$</span> so that we have <code>100*100=10000</code> points for each reactant. Notice how fast that grows! Put the reactants in a matrix such that <code>A[i,j] = A(x_j,y_i)</code>, i.e. the columns of the matrix are the <span>$x$</span> values and the rows are the <span>$y$</span> values (this way looking at the matrix is essentially like looking at the discretized space).</p><p>So now we have 3 matrices (<code>A</code>, <code>B</code>, and <code>C</code>) for our reactants. How do we discretize the PDE? In this case, the diffusion term simply becomes a tridiagonal matrix <span>$M$</span> where <span>$[1,-2,1]$</span> is the central band. You can notice that <span>$MA$</span> performs diffusion along the columns of <span>$A$</span>, and so this is diffusion along the <span>$y$</span>. Similarly, <span>$AM$</span> flips the indices and thus does diffusion along the rows of <span>$A$</span> making this diffusion along <span>$x$</span>. Thus <span>$D(M_yA + AM_x)$</span> is the discretized Laplacian (we could have separate diffusion constants and <span>$dx \neq dy$</span> if we want by using different constants on the <span>$M$</span>, but let&#39;s not do that for this simple example. We leave that as an exercise for the reader). We enforced a Neumann boundary condition with zero derivative (also known as a no-flux boundary condition) by reflecting the changes over the boundary. Thus the derivative operator is generated as:</p><pre><code class="language-julia hljs">using LinearAlgebra

# Define the constants for the PDE
const α₂ = 1.0
const α₃ = 1.0
const β₁ = 1.0
const β₂ = 1.0
const β₃ = 1.0
const r₁ = 1.0
const r₂ = 1.0
const D = 100.0
const γ₁ = 0.1
const γ₂ = 0.1
const γ₃ = 0.1
const N = 100
const X = reshape([i for i in 1:100 for j in 1:100], N, N)
const Y = reshape([j for i in 1:100 for j in 1:100], N, N)
const α₁ = 1.0 .* (X .&gt;= 80)

const Mx = Tridiagonal([1.0 for i in 1:(N - 1)], [-2.0 for i in 1:N],
                       [1.0 for i in 1:(N - 1)])
const My = copy(Mx)
# Do the reflections, different for x and y operators
Mx[2, 1] = 2.0
Mx[end - 1, end] = 2.0
My[1, 2] = 2.0
My[end, end - 1] = 2.0</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2.0</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We could have also done these discretization steps using <a href="https://docs.sciml.ai/DiffEqOperators/stable/">DiffEqOperators.jl</a> or <a href="https://docs.sciml.ai/MethodOfLines/stable/">MethodOfLines.jl</a>. However, we are going to keep it in this form, so we can show the full code, making it easier to see how to define GPU-ready code!</p></div></div><p>Since all of the reactions are local, we only have each point in space react separately. Thus this represents itself as element-wise equations on the reactants. Thus we can write it out quite simply. The ODE which then represents the PDE is thus in pseudo Julia code:</p><pre><code class="language-julia hljs">DA = D * (Mx * A + A * My)
@. DA + α₁ - β₁ * A - r₁ * A * B + r₂ * C
@. α₂ - β₂ * B - r₁ * A * B + r₂ * C
@. α₃ - β₃ * C + r₁ * A * B - r₂ * C</code></pre><p>Note here that I am using α₁ as a matrix (or row-vector, since that will broadcast just fine) where every point in space with x&lt;80 has this zero, and all of the others have it as a constant. The other coefficients are all scalars.</p><p>How do we do this with the ODE solver?</p><h2 id="Our-Representation-via-Views-of-3-Tensors"><a class="docs-heading-anchor" href="#Our-Representation-via-Views-of-3-Tensors">Our Representation via Views of 3-Tensors</a><a id="Our-Representation-via-Views-of-3-Tensors-1"></a><a class="docs-heading-anchor-permalink" href="#Our-Representation-via-Views-of-3-Tensors" title="Permalink"></a></h2><p>We can represent our problem with a 3-dimensional tensor, taking each 2-dimensional slice as our (A,B,C). This means that we can define:</p><pre><code class="language-julia hljs">u0 = zeros(N, N, 3);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">100×100×3 Array{Float64, 3}:
[:, :, 1] =
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 ⋮                        ⋮              ⋱            ⋮                   
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0

[:, :, 2] =
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 ⋮                        ⋮              ⋱            ⋮                   
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0

[:, :, 3] =
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 ⋮                        ⋮              ⋱            ⋮                   
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0</code></pre><p>Now we can decompose it like:</p><pre><code class="language-julia hljs">A = @view u[:, :, 1]
B = @view u[:, :, 2]
C = @view u[:, :, 3]
dA = @view du[:, :, 1]
dB = @view du[:, :, 2]
dC = @view du[:, :, 3]</code></pre><p>These views will not construct new arrays and will instead just be pointers to the (contiguous) memory pieces, so this is a nice and efficient way to handle this. Together, our ODE using this tensor as its container can be written as follows:</p><pre><code class="language-julia hljs">function f(du, u, p, t)
    A = @view u[:, :, 1]
    B = @view u[:, :, 2]
    C = @view u[:, :, 3]
    dA = @view du[:, :, 1]
    dB = @view du[:, :, 2]
    dC = @view du[:, :, 3]
    DA = D * (Mx * A + A * My)
    @. dA = DA + α₁ - β₁ * A - r₁ * A * B + r₂ * C
    @. dB = α₂ - β₂ * B - r₁ * A * B + r₂ * C
    @. dC = α₃ - β₃ * C + r₁ * A * B - r₂ * C
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">f (generic function with 1 method)</code></pre><p>where this is using @. to do inplace updates on our du to say how the full tensor should update in time. Note that we can make this more efficient by adding some cache variables to the diffusion matrix multiplications and using mul!, but let&#39;s ignore that for now.</p><p>Together, the ODE which defines our PDE is thus:</p><pre><code class="language-julia hljs">using DifferentialEquations

prob = ODEProblem(f, u0, (0.0, 100.0))
@time sol = solve(prob, ROCK2());</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 3rd order Hermite
t: 125-element Vector{Float64}:
   0.0
   2.796123741859731e-5
   6.437859112070983e-5
   0.0001355696558501728
   0.00023376199838581863
   0.0003776022263950997
   0.000565057887749957
   0.0008071655660257587
   0.0011053533031798865
   0.001466685803229837
   ⋮
   7.947518012781672
   9.216398069047099
  11.048709859457816
  13.932713724920005
  18.815455951532602
  27.10742394873848
  43.60845467747508
  74.75755579382653
 100.0
u: 125-element Vector{Array{Float64, 3}}:
 [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0;;; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0;;; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]
 [3.906344697357476e-10 3.909112473032509e-10 … 2.796119589268521e-5 2.7883165317332937e-5; 3.909112473032509e-10 3.911880248707541e-10 … 2.8039337179064475e-5 2.796119589268521e-5; … ; 3.909112473032509e-10 3.911880248707541e-10 … 2.8039337179064475e-5 2.796119589268521e-5; 3.906344697357476e-10 3.909112473032509e-10 … 2.796119589268521e-5 2.7883165317332937e-5;;; 2.7961237415829508e-5 2.7961237415829508e-5 … 2.7961237409320334e-5 2.79612374093249e-5; 2.7961237415829508e-5 2.7961237415829508e-5 … 2.796123740931577e-5 2.7961237409320334e-5; … ; 2.7961237415829508e-5 2.7961237415829508e-5 … 2.796123740931577e-5 2.7961237409320334e-5; 2.7961237415829508e-5 2.7961237415829508e-5 … 2.7961237409320334e-5 2.79612374093249e-5;;; 2.7960455593334905e-5 2.7960455593334905e-5 … 2.796045559984408e-5 2.7960455599839515e-5; 2.7960455593334905e-5 2.7960455593334905e-5 … 2.7960455599848643e-5 2.796045559984408e-5; … ; 2.7960455593334905e-5 2.7960455593334905e-5 … 2.7960455599848643e-5 2.796045559984408e-5; 2.7960455593334905e-5 2.7960455593334905e-5 … 2.796045559984408e-5 2.7960455599839515e-5]
 [2.064777915080023e-9 2.07217804373864e-9 … 6.437748464989885e-5 6.396710057888366e-5; 2.07217804373864e-9 2.0796096029871125e-9 … 6.47908131237352e-5 6.437748464989885e-5; … ; 2.07217804373864e-9 2.0796096029871125e-9 … 6.47908131237352e-5 6.437748464989885e-5; 2.064777915080023e-9 2.07217804373864e-9 … 6.437748464989885e-5 6.396710057888366e-5;;; 6.437859104627274e-5 6.437859104627274e-5 … 6.437859095983186e-5 6.437859096018008e-5; 6.437859104627274e-5 6.437859104627273e-5 … 6.437859095948209e-5 6.437859095983186e-5; … ; 6.437859104627274e-5 6.437859104627273e-5 … 6.437859095948209e-5 6.437859095983186e-5; 6.437859104627274e-5 6.437859104627274e-5 … 6.437859095983186e-5 6.437859096018008e-5;;; 6.437444666658912e-5 6.437444666658914e-5 … 6.437444675303001e-5 6.43744467526818e-5; 6.437444666658914e-5 6.437444666658914e-5 … 6.437444675337979e-5 6.437444675303001e-5; … ; 6.437444666658914e-5 6.437444666658914e-5 … 6.437444675337979e-5 6.437444675303001e-5; 6.437444666658912e-5 6.437444666658914e-5 … 6.437444675303001e-5 6.43744467526818e-5]
 [9.115090300876016e-9 9.18816509527637e-9 … 0.00013555878362043303 0.000133761104469766; 9.18816509527637e-9 9.262006848947153e-9 … 0.00013738531104727627 0.00013555878362043303; … ; 9.18816509527637e-9 9.262006848947153e-9 … 0.00013738531104727627 0.00013555878362043303; 9.115090300876016e-9 9.18816509527637e-9 … 0.00013555878362043303 0.000133761104469766;;; 0.00013556965510873605 0.00013556965510873586 … 0.00013556965429362562 0.00013556965430078604; 0.00013556965510873586 0.00013556965510873567 … 0.0001355696542863866 0.00013556965429362562; … ; 0.00013556965510873586 0.00013556965510873567 … 0.0001355696542863866 0.00013556965429362562; 0.00013556965510873605 0.00013556965510873586 … 0.00013556965429362562 0.00013556965430078604;;; 0.0001355512782014618 0.000135551278201462 … 0.00013555127901657225 0.00013555127900941182; 0.000135551278201462 0.0001355512782014622 … 0.00013555127902381128 0.00013555127901657225; … ; 0.000135551278201462 0.0001355512782014622 … 0.00013555127902381128 0.00013555127901657225; 0.0001355512782014618 0.000135551278201462 … 0.00013555127901657225 0.00013555127900941182]
 [2.6926897581315367e-8 2.7313507714770143e-8 … 0.00023370489649268138 0.00022845315379793862; 2.7313507714770143e-8 2.7707718844309493e-8 … 0.0002391075039605557 0.00023370489649268138; … ; 2.7313507714770143e-8 2.7707718844309493e-8 … 0.0002391075039605557 0.00023370489649268138; 2.6926897581315367e-8 2.7313507714770143e-8 … 0.00023370489649268138 0.00022845315379793862;;; 0.00023376199441293072 0.00023376199441292722 … 0.0002337619902052695 0.00023376199027161357; 0.00023376199441292722 0.00023376199441292367 … 0.00023376199013754758 0.0002337619902052695; … ; 0.00023376199441292722 0.00023376199441292367 … 0.00023376199013754758 0.0002337619902052695; 0.00023376199441293072 0.00023376199441292722 … 0.0002337619902052695 0.00023376199027161357;;; 0.00023370736165976154 0.0002337073616597651 … 0.00023370736586742275 0.0002337073658010787; 0.0002337073616597651 0.0002337073616597686 … 0.0002337073659351447 0.00023370736586742275; … ; 0.0002337073616597651 0.0002337073616597686 … 0.0002337073659351447 0.00023370736586742275; 0.00023370736165976154 0.0002337073616597651 … 0.00023370736586742275 0.0002337073658010787]
 [6.961732292649316e-8 7.124591837656885e-8 … 0.00037736420948259527 0.0003640011486945887; 7.124591837656885e-8 7.292787278493182e-8 … 0.0003913522086821116 0.00037736420948259527; … ; 7.124591837656885e-8 7.292787278493182e-8 … 0.0003913522086821116 0.00037736420948259527; 6.961732292649316e-8 7.124591837656885e-8 … 0.00037736420948259527 0.0003640011486945887;;; 0.0003776022093504568 0.0003776022093504163 … 0.00037760219156997705 0.00037760219202269337; 0.0003776022093504163 0.0003776022093503748 … 0.000377602191101566 0.00037760219156997705; … ; 0.0003776022093504163 0.0003776022093503748 … 0.000377602191101566 0.00037760219156997705; 0.0003776022093504568 0.0003776022093504163 … 0.00037760219156997705 0.00037760219202269337;;; 0.00037745967704351697 0.00037745967704355747 … 0.00037745969482399675 0.0003774596943712805; 0.00037745967704355747 0.00037745967704359894 … 0.00037745969529240787 0.00037745969482399675; … ; 0.00037745967704355747 0.00037745967704359894 … 0.00037745969529240787 0.00037745969482399675; 0.00037745967704351697 0.00037745967704355747 … 0.00037745969482399675 0.0003774596943712805]
 [1.540579894733325e-7 1.5945566561169678e-7 … 0.0005642799709081393 0.0005353147081300882; 1.5945566561169678e-7 1.6512254090905263e-7 … 0.0005952708190357286 0.0005642799709081393; … ; 1.5945566561169678e-7 1.6512254090905263e-7 … 0.0005952708190357286 0.0005642799709081393; 1.540579894733325e-7 1.5945566561169678e-7 … 0.0005642799709081393 0.0005353147081300882;;; 0.0005650578298830339 0.0005650578298827208 … 0.000565057770205711 0.0005650577724579198; 0.0005650578298827208 0.0005650578298823957 … 0.0005650577678343024 0.000565057770205711; … ; 0.0005650578298827208 0.0005650578298823957 … 0.0005650577678343024 0.000565057770205711; 0.0005650578298830339 0.0005650578298827208 … 0.000565057770205711 0.0005650577724579198;;; 0.0005647387130703668 0.0005647387130706799 … 0.0005647387727476897 0.0005647387704954811; 0.0005647387130706799 0.0005647387130710051 … 0.0005647387751190984 0.0005647387727476897; … ; 0.0005647387130706799 0.0005647387130710051 … 0.0005647387751190984 0.0005647387727476897; 0.0005647387130703668 0.0005647387130706799 … 0.0005647387727476897 0.0005647387704954811]
 [3.0969738789168484e-7 3.2507995129791364e-7 … 0.0008049880902276838 0.0007482706516369002; 3.2507995129791364e-7 3.415619008018545e-7 … 0.0008673145106382796 0.0008049880902276838; … ; 3.2507995129791364e-7 3.415619008018545e-7 … 0.0008673145106382796 0.0008049880902276838; 3.0969738789168484e-7 3.2507995129791364e-7 … 0.0008049880902276838 0.0007482706516369002;;; 0.0008071653959737827 0.0008071653959719099 … 0.0008071652219566872 0.0008071652311307488; 0.0008071653959719099 0.0008071653959699315 … 0.0008071652120858652 0.0008071652219566872; … ; 0.0008071653959719099 0.0008071653959699315 … 0.0008071652120858652 0.0008071652219566872; 0.0008071653959737827 0.0008071653959719099 … 0.0008071652219566872 0.0008071652311307488;;; 0.0008065143898932863 0.0008065143898951592 … 0.0008065145639103818 0.0008065145547363204; 0.0008065143898951592 0.0008065143898971374 … 0.0008065145737812039 0.0008065145639103818; … ; 0.0008065143898951592 0.0008065143898971374 … 0.0008065145737812039 0.0008065145639103818; 0.0008065143898932863 0.0008065143898951592 … 0.0008065145639103818 0.0008065145547363204]
 [5.705076773905195e-7 6.087951811632106e-7 … 0.0011000514541360741 0.0009988289301903872; 6.087951811632106e-7 6.508085123006421e-7 … 0.0012147497953614846 0.0011000514541360741; … ; 6.087951811632106e-7 6.508085123006421e-7 … 0.0012147497953614846 0.0011000514541360741; 5.705076773905195e-7 6.087951811632106e-7 … 0.0011000514541360741 0.0009988289301903872;;; 0.0011053528638517067 0.001105352863842754 … 0.0011053524171780035 0.0011053524484369427; 0.001105352863842754 0.0011053528638331044 … 0.0011053523826827932 0.0011053524171780035; … ; 0.001105352863842754 0.0011053528638331044 … 0.0011053523826827932 0.0011053524171780035; 0.0011053528638517067 0.001105352863842754 … 0.0011053524171780035 0.0011053524484369427;;; 0.001104132375968241 0.0011041323759771937 … 0.0011041328226419442 0.0011041327913830052; 0.0011041323759771937 0.0011041323759868433 … 0.0011041328571371547 0.0011041328226419442; … ; 0.0011041323759771937 0.0011041323759868433 … 0.0011041328571371547 0.0011041328226419442; 0.001104132375968241 0.0011041323759771937 … 0.0011041328226419442 0.0011041327913830052]
 [9.837734761082027e-7 1.069728314870665e-6 … 0.0014550919403635942 0.001286939535979884; 1.069728314870665e-6 1.1666270528831613e-6 … 0.0016522401555657791 0.0014550919403635942; … ; 1.069728314870665e-6 1.1666270528831613e-6 … 0.0016522401555657791 0.0014550919403635942; 9.837734761082027e-7 1.069728314870665e-6 … 0.0014550919403635942 0.001286939535979884;;; 0.0014666847725153 0.0014666847724792008 … 0.0014666837305651816 0.0014666838235512587; 0.0014666847724792008 0.0014666847724393811 … 0.0014666836249749018 0.0014666837305651816; … ; 0.0014666847724792008 0.0014666847724393811 … 0.0014666836249749018 0.0014666837305651816; 0.0014666847725153 0.0014666847724792008 … 0.0014666837305651816 0.0014666838235512587;;; 0.001464536697606192 0.0014645366976422912 … 0.0014645377395563106 0.0014645376465702335; 0.0014645366976422912 0.001464536697682111 … 0.0014645378451465904 0.0014645377395563106; … ; 0.0014645366976422912 0.001464536697682111 … 0.0014645378451465904 0.0014645377395563106; 0.001464536697606192 0.0014645366976422912 … 0.0014645377395563106 0.0014645376465702335]
 ⋮
 [0.0860980584145309 0.17043647381136437 … 0.5253487807847173 0.2653793414280966; 0.17043632607368323 0.3382712254382821 … 1.0431153649867155 0.5255803265164318; … ; 0.17043632607047352 0.338271225445665 … 1.0431153649877962 0.5255803265126668; 0.08609805841464986 0.1704364738091774 … 0.5253487807877247 0.265379341430695;;; 1.4373252284252627 1.381514056133696 … 1.1874256906452123 1.3236301768644763; 1.3815141490947984 1.282410462486958 … 0.9854451339241748 1.1873168599586519; … ; 1.3815141490947924 1.2824104624869688 … 0.9854451339241813 1.1873168599586483; 1.4373252284252602 1.3815140561336967 … 1.1874256906452232 1.3236301768644851;;; 0.5618219481395736 0.6176331204311375 … 0.8117214859196261 0.6755169997003598; 0.6176330274700377 0.7167367140778765 … 1.0137020426406604 0.811830316606183; … ; 0.6176330274700433 0.7167367140778665 … 1.0137020426406564 0.811830316606187; 0.5618219481395745 0.6176331204311389 … 0.8117214859196145 0.6755169997003496]
 [0.08611716284361551 0.17047468757767417 … 0.5254093393090755 0.265409623784774; 0.17047453796637485 0.33834765744416206 … 1.043236489945349 0.5256408960059097; … ; 0.17047453797624784 0.3383476574329872 … 1.0432364899545734 0.5256408960113826; 0.08611716284187021 0.17047468757644577 … 0.5254093392900094 0.26540962378754035;;; 1.4378006045760103 1.3819336252553542 … 1.1877342572082403 1.3240275973003055; 1.3819337199879664 1.2827436621439456 … 0.9856521249815257 1.1876253748112229; … ; 1.3819337199879878 1.282743662143918 … 0.9856521249815371 1.187625374811248; 1.4378006045760054 1.3819336252553445 … 1.1877342572081835 1.3240275973003033;;; 0.5618903141179099 0.6177572934385639 … 0.8119566614856801 0.6756633213936142; 0.6177571987059528 0.716947256549974 … 1.014038793712393 0.8120655438826948; … ; 0.6177571987059314 0.7169472565500006 … 1.014038793712381 0.812065543882672; 0.5618903141179137 0.6177572934385737 … 0.8119566614857363 0.675663321393615]
 [0.08612424653409514 0.1704888541714203 … 0.5254313531199226 0.26542063415503336; 0.17048870388305637 0.3383759883686652 … 1.0432805111692454 0.5256629133739961; … ; 0.1704887038883321 0.33837598835841554 … 1.0432805111290577 0.5256629134018219; 0.08612424653691521 0.17048885417575446 … 0.5254313531223933 0.2654206341449212;;; 1.4379761857636695 1.3820885642569618 … 1.187848575254823 1.3241746260446108; 1.3820886597402704 1.2828666720897481 … 0.9857290285709916 1.1877396740993025; … ; 1.382088659740295 1.2828666720897104 … 0.985729028570942 1.1877396740993493; 1.4379761857636821 1.3820885642569747 … 1.1878485752547856 1.3241746260445781;;; 0.5619155910916934 0.6178032125983992 … 0.81204320160054 0.675717150810749; 0.6178031171150915 0.7170251047656166 … 1.014162748284371 0.8121521027560599; … ; 0.6178031171150687 0.7170251047656533 … 1.01416274828442 0.8121521027560125; 0.5619155910916772 0.6178032125983878 … 0.8120432016005785 0.6757171508107845]
 [0.08612614504602102 0.17049265171457642 … 0.525437120686977 0.26542351832198846; 0.1704925012778496 0.33838358347625414 … 1.0432920459311534 0.5256686816812286; … ; 0.17049250125561458 0.33838358352274106 … 1.0432920462707862 0.5256686816281663; 0.08612614502946425 0.17049265174051192 … 0.5254371206311342 0.26542351827734434;;; 1.4380217482813722 1.3821288252436692 … 1.1878784162080114 1.3242128480702946; 1.382128920937962 1.282898770102663 … 0.9857493588365255 1.187769510236514; … ; 1.3821289209378955 1.2828987701027577 … 0.9857493588371241 1.1877695102364358; 1.4380217482813036 1.382128825243725 … 1.1878784162079201 1.3242128480701114;;; 0.5619220947768395 0.6178150178145437 … 0.81206542685021 0.6757309949879174; 0.6178149221202488 0.7170450729555525 … 1.0141944842216821 0.8121743328217007; … ; 0.6178149221203245 0.7170450729554643 … 1.0141944842210908 0.8121743328217819; 0.5619220947769019 0.6178150178144902 … 0.8120654268503005 0.6757309949881005]
 [0.0861263484550237 0.1704930588114406 … 0.5254376433059956 0.26542377925479826; 0.1704929083575903 0.3383843985532119 … 1.043293094769307 0.5256692044097837; … ; 0.1704929083179532 0.3383843985504839 … 1.0432930941125902 0.5256692047684617; 0.08612634841214753 0.17049305897868994 … 0.5254376437522809 0.2654237789478525;;; 1.4380264806957288 1.3821330324293595 … 1.1878815936547746 1.324216899594982; 1.3821331281547102 1.2829020891792937 … 0.9857513300943188 1.1877726872009684; … ; 1.3821331281546714 1.2829020891793919 … 0.9857513300935629 1.1877726872015324; 1.4380264806956726 1.382133032429838 … 1.1878815936554665 1.3242168995943688;;; 0.5619227864032379 0.6178162346696093 … 0.812067673444226 0.6757323675039573; 0.6178161389442847 0.7170471779196865 … 1.0141979370046275 0.8121765798980022; … ; 0.6178161389443182 0.7170471779195954 … 1.0141979370054217 0.8121765798974202; 0.561922786403297 0.61781623466914 … 0.8120676734434983 0.6757323675045981]
 [0.08612696916103961 0.1704942996211746 … 0.5254400816807748 0.26542500060545304; 0.17049414903877258 0.3383868795724996 … 1.043297975800099 0.5256716441583383; … ; 0.17049414919857298 0.33838687869515427 … 1.0432979721279094 0.5256716450098741; 0.08612696914432466 0.17049429987008752 … 0.525440082168004 0.26542500091475424;;; 1.4380418735129417 1.3821466102175435 … 1.1878911197329391 1.324229463323031; 1.3821467059253385 1.2829128644483128 … 0.9857575482619754 1.1877822109612353; … ; 1.3821467059252304 1.282912864446957 … 0.9857575482563989 1.1877822109616085; 1.4380418735133622 1.3821466102178275 … 1.1878911197332265 1.3242294633241454;;; 0.5619250181562303 0.6178202814514968 … 0.8120757719362344 0.675737428346068; 0.6178201857436643 0.7170540272208108 … 1.014209343407195 0.8121846807079487; … ; 0.6178201857438892 0.7170540272223528 … 1.014209343412782 0.8121846807075852; 0.5619250181559755 0.6178202814512223 … 0.8120757719358355 0.6757374283449257]
 [0.08612922377484898 0.17049880746230267 … 0.5254468148723012 0.26542836358957134; 0.17049865534065103 0.33839590092128835 … 1.0433114145796933 0.5256783805383086; … ; 0.17049865860770871 0.3383958958161563 … 1.0433114239576757 0.5256783777167134; 0.08612922322293583 0.17049880814212776 … 0.525446811840995 0.2654283642611259;;; 1.4380984980593468 1.382196601013655 … 1.1879282918393537 1.3242770694216377; 1.382196697047234 1.2829525933107075 … 0.9857827134840025 1.1878193774417978; … ; 1.3821966970533412 1.2829525932993169 … 0.9857827134916414 1.1878193774431431; 1.43809849805989 1.3821966010112683 … 1.1879282918325718 1.3242770694231056;;; 0.5619331295482851 0.6178350265953393 … 0.8121033357688703 0.6757545581872626; 0.6178349305618676 0.7170790342975233 … 1.0142489141247812 0.8122122501663108; … ; 0.6178349305548604 0.7170790343096268 … 1.014248914116363 0.812212250165756; 0.5619331295484676 0.6178350265969836 … 0.8121033357761148 0.675754558186087]
 [0.08612916330502197 0.17049869317371466 … 0.5254465304448525 0.2654282163618434; 0.17049854499628475 0.33839566059686466 … 1.0433108429459548 0.5256780726382269; … ; 0.17049854184749363 0.3383956617550718 … 1.0433108543112954 0.5256780602391141; 0.08612916171450978 0.17049869578421842 … 0.5254465182386399 0.2654282327286097;;; 1.438096899651587 1.3821951874950726 … 1.1879273352067259 1.324275791897684; 1.3821952836875342 1.2829514631453598 … 0.985782108932073 1.1878184210379235; … ; 1.3821952836664313 1.2829514631602468 … 0.9857821089456186 1.187818421030176; 1.4380968996444772 1.3821951874942873 … 1.187927335176687 1.3242757919422374;;; 0.5619328997439027 0.6178346119017598 … 0.8121024641884341 0.6757540074995592; 0.6178345157098714 0.7170783362480253 … 1.0142476904650342 0.8122113783598383; … ; 0.6178345157287075 0.7170783362385516 … 1.0142476904497297 0.8122113783638633; 0.5619328997500804 0.6178346119013959 … 0.8121024642139002 0.6757540074487606]
 [0.08612858502693178 0.17049753011854185 … 0.5254450995508656 0.2654275119357499; 0.17049737654539124 0.33839335967131645 … 1.0433080246587925 0.5256766560874475; … ; 0.17049739061254476 0.33839332923662874 … 1.0433080297881574 0.5256766653154703; 0.08612858461742168 0.17049753677333118 … 0.5254450841778983 0.2654275090734674;;; 1.4380834767959698 1.382183387135683 … 1.1879183611000284 1.3242643710114153; 1.3821834831479929 1.2829421711018256 … 0.9857759838047694 1.1878094482253942; … ; 1.3821834831841513 1.282942171049491 … 0.9857759838212017 1.1878094482498152; 1.4380834768058741 1.3821833871480351 … 1.18791836103523 1.324264370990561;;; 0.5619309119379512 0.6178310015967424 … 0.8120960276328201 0.6757500177235799; 0.617830905584656 0.7170722176292615 … 1.014238404929981 0.8122049405078227; … ; 0.6178309055491185 0.7170722176846236 … 1.0142384049122126 0.8122049404803533; 0.5619309119268662 0.6178310015838927 … 0.8120960276957662 0.675750017738761]</code></pre><pre><code class="language-julia hljs">@time sol = solve(prob, ROCK2());</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 3rd order Hermite
t: 125-element Vector{Float64}:
   0.0
   2.796123741859731e-5
   6.437859112070983e-5
   0.0001355696558501728
   0.00023376199838581863
   0.0003776022263950997
   0.000565057887749957
   0.0008071655660257587
   0.0011053533031798865
   0.001466685803229837
   ⋮
   7.947518012781672
   9.216398069047099
  11.048709859457816
  13.932713724920005
  18.815455951532602
  27.10742394873848
  43.60845467747508
  74.75755579382653
 100.0
u: 125-element Vector{Array{Float64, 3}}:
 [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0;;; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0;;; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]
 [3.906344697357476e-10 3.909112473032509e-10 … 2.796119589268521e-5 2.7883165317332937e-5; 3.909112473032509e-10 3.911880248707541e-10 … 2.8039337179064475e-5 2.796119589268521e-5; … ; 3.909112473032509e-10 3.911880248707541e-10 … 2.8039337179064475e-5 2.796119589268521e-5; 3.906344697357476e-10 3.909112473032509e-10 … 2.796119589268521e-5 2.7883165317332937e-5;;; 2.7961237415829508e-5 2.7961237415829508e-5 … 2.7961237409320334e-5 2.79612374093249e-5; 2.7961237415829508e-5 2.7961237415829508e-5 … 2.796123740931577e-5 2.7961237409320334e-5; … ; 2.7961237415829508e-5 2.7961237415829508e-5 … 2.796123740931577e-5 2.7961237409320334e-5; 2.7961237415829508e-5 2.7961237415829508e-5 … 2.7961237409320334e-5 2.79612374093249e-5;;; 2.7960455593334905e-5 2.7960455593334905e-5 … 2.796045559984408e-5 2.7960455599839515e-5; 2.7960455593334905e-5 2.7960455593334905e-5 … 2.7960455599848643e-5 2.796045559984408e-5; … ; 2.7960455593334905e-5 2.7960455593334905e-5 … 2.7960455599848643e-5 2.796045559984408e-5; 2.7960455593334905e-5 2.7960455593334905e-5 … 2.796045559984408e-5 2.7960455599839515e-5]
 [2.064777915080023e-9 2.07217804373864e-9 … 6.437748464989885e-5 6.396710057888366e-5; 2.07217804373864e-9 2.0796096029871125e-9 … 6.47908131237352e-5 6.437748464989885e-5; … ; 2.07217804373864e-9 2.0796096029871125e-9 … 6.47908131237352e-5 6.437748464989885e-5; 2.064777915080023e-9 2.07217804373864e-9 … 6.437748464989885e-5 6.396710057888366e-5;;; 6.437859104627274e-5 6.437859104627274e-5 … 6.437859095983186e-5 6.437859096018008e-5; 6.437859104627274e-5 6.437859104627273e-5 … 6.437859095948209e-5 6.437859095983186e-5; … ; 6.437859104627274e-5 6.437859104627273e-5 … 6.437859095948209e-5 6.437859095983186e-5; 6.437859104627274e-5 6.437859104627274e-5 … 6.437859095983186e-5 6.437859096018008e-5;;; 6.437444666658912e-5 6.437444666658914e-5 … 6.437444675303001e-5 6.43744467526818e-5; 6.437444666658914e-5 6.437444666658914e-5 … 6.437444675337979e-5 6.437444675303001e-5; … ; 6.437444666658914e-5 6.437444666658914e-5 … 6.437444675337979e-5 6.437444675303001e-5; 6.437444666658912e-5 6.437444666658914e-5 … 6.437444675303001e-5 6.43744467526818e-5]
 [9.115090300876016e-9 9.18816509527637e-9 … 0.00013555878362043303 0.000133761104469766; 9.18816509527637e-9 9.262006848947153e-9 … 0.00013738531104727627 0.00013555878362043303; … ; 9.18816509527637e-9 9.262006848947153e-9 … 0.00013738531104727627 0.00013555878362043303; 9.115090300876016e-9 9.18816509527637e-9 … 0.00013555878362043303 0.000133761104469766;;; 0.00013556965510873605 0.00013556965510873586 … 0.00013556965429362562 0.00013556965430078604; 0.00013556965510873586 0.00013556965510873567 … 0.0001355696542863866 0.00013556965429362562; … ; 0.00013556965510873586 0.00013556965510873567 … 0.0001355696542863866 0.00013556965429362562; 0.00013556965510873605 0.00013556965510873586 … 0.00013556965429362562 0.00013556965430078604;;; 0.0001355512782014618 0.000135551278201462 … 0.00013555127901657225 0.00013555127900941182; 0.000135551278201462 0.0001355512782014622 … 0.00013555127902381128 0.00013555127901657225; … ; 0.000135551278201462 0.0001355512782014622 … 0.00013555127902381128 0.00013555127901657225; 0.0001355512782014618 0.000135551278201462 … 0.00013555127901657225 0.00013555127900941182]
 [2.6926897581315367e-8 2.7313507714770143e-8 … 0.00023370489649268138 0.00022845315379793862; 2.7313507714770143e-8 2.7707718844309493e-8 … 0.0002391075039605557 0.00023370489649268138; … ; 2.7313507714770143e-8 2.7707718844309493e-8 … 0.0002391075039605557 0.00023370489649268138; 2.6926897581315367e-8 2.7313507714770143e-8 … 0.00023370489649268138 0.00022845315379793862;;; 0.00023376199441293072 0.00023376199441292722 … 0.0002337619902052695 0.00023376199027161357; 0.00023376199441292722 0.00023376199441292367 … 0.00023376199013754758 0.0002337619902052695; … ; 0.00023376199441292722 0.00023376199441292367 … 0.00023376199013754758 0.0002337619902052695; 0.00023376199441293072 0.00023376199441292722 … 0.0002337619902052695 0.00023376199027161357;;; 0.00023370736165976154 0.0002337073616597651 … 0.00023370736586742275 0.0002337073658010787; 0.0002337073616597651 0.0002337073616597686 … 0.0002337073659351447 0.00023370736586742275; … ; 0.0002337073616597651 0.0002337073616597686 … 0.0002337073659351447 0.00023370736586742275; 0.00023370736165976154 0.0002337073616597651 … 0.00023370736586742275 0.0002337073658010787]
 [6.961732292649316e-8 7.124591837656885e-8 … 0.00037736420948259527 0.0003640011486945887; 7.124591837656885e-8 7.292787278493182e-8 … 0.0003913522086821116 0.00037736420948259527; … ; 7.124591837656885e-8 7.292787278493182e-8 … 0.0003913522086821116 0.00037736420948259527; 6.961732292649316e-8 7.124591837656885e-8 … 0.00037736420948259527 0.0003640011486945887;;; 0.0003776022093504568 0.0003776022093504163 … 0.00037760219156997705 0.00037760219202269337; 0.0003776022093504163 0.0003776022093503748 … 0.000377602191101566 0.00037760219156997705; … ; 0.0003776022093504163 0.0003776022093503748 … 0.000377602191101566 0.00037760219156997705; 0.0003776022093504568 0.0003776022093504163 … 0.00037760219156997705 0.00037760219202269337;;; 0.00037745967704351697 0.00037745967704355747 … 0.00037745969482399675 0.0003774596943712805; 0.00037745967704355747 0.00037745967704359894 … 0.00037745969529240787 0.00037745969482399675; … ; 0.00037745967704355747 0.00037745967704359894 … 0.00037745969529240787 0.00037745969482399675; 0.00037745967704351697 0.00037745967704355747 … 0.00037745969482399675 0.0003774596943712805]
 [1.540579894733325e-7 1.5945566561169678e-7 … 0.0005642799709081393 0.0005353147081300882; 1.5945566561169678e-7 1.6512254090905263e-7 … 0.0005952708190357286 0.0005642799709081393; … ; 1.5945566561169678e-7 1.6512254090905263e-7 … 0.0005952708190357286 0.0005642799709081393; 1.540579894733325e-7 1.5945566561169678e-7 … 0.0005642799709081393 0.0005353147081300882;;; 0.0005650578298830339 0.0005650578298827208 … 0.000565057770205711 0.0005650577724579198; 0.0005650578298827208 0.0005650578298823957 … 0.0005650577678343024 0.000565057770205711; … ; 0.0005650578298827208 0.0005650578298823957 … 0.0005650577678343024 0.000565057770205711; 0.0005650578298830339 0.0005650578298827208 … 0.000565057770205711 0.0005650577724579198;;; 0.0005647387130703668 0.0005647387130706799 … 0.0005647387727476897 0.0005647387704954811; 0.0005647387130706799 0.0005647387130710051 … 0.0005647387751190984 0.0005647387727476897; … ; 0.0005647387130706799 0.0005647387130710051 … 0.0005647387751190984 0.0005647387727476897; 0.0005647387130703668 0.0005647387130706799 … 0.0005647387727476897 0.0005647387704954811]
 [3.0969738789168484e-7 3.2507995129791364e-7 … 0.0008049880902276838 0.0007482706516369002; 3.2507995129791364e-7 3.415619008018545e-7 … 0.0008673145106382796 0.0008049880902276838; … ; 3.2507995129791364e-7 3.415619008018545e-7 … 0.0008673145106382796 0.0008049880902276838; 3.0969738789168484e-7 3.2507995129791364e-7 … 0.0008049880902276838 0.0007482706516369002;;; 0.0008071653959737827 0.0008071653959719099 … 0.0008071652219566872 0.0008071652311307488; 0.0008071653959719099 0.0008071653959699315 … 0.0008071652120858652 0.0008071652219566872; … ; 0.0008071653959719099 0.0008071653959699315 … 0.0008071652120858652 0.0008071652219566872; 0.0008071653959737827 0.0008071653959719099 … 0.0008071652219566872 0.0008071652311307488;;; 0.0008065143898932863 0.0008065143898951592 … 0.0008065145639103818 0.0008065145547363204; 0.0008065143898951592 0.0008065143898971374 … 0.0008065145737812039 0.0008065145639103818; … ; 0.0008065143898951592 0.0008065143898971374 … 0.0008065145737812039 0.0008065145639103818; 0.0008065143898932863 0.0008065143898951592 … 0.0008065145639103818 0.0008065145547363204]
 [5.705076773905195e-7 6.087951811632106e-7 … 0.0011000514541360741 0.0009988289301903872; 6.087951811632106e-7 6.508085123006421e-7 … 0.0012147497953614846 0.0011000514541360741; … ; 6.087951811632106e-7 6.508085123006421e-7 … 0.0012147497953614846 0.0011000514541360741; 5.705076773905195e-7 6.087951811632106e-7 … 0.0011000514541360741 0.0009988289301903872;;; 0.0011053528638517067 0.001105352863842754 … 0.0011053524171780035 0.0011053524484369427; 0.001105352863842754 0.0011053528638331044 … 0.0011053523826827932 0.0011053524171780035; … ; 0.001105352863842754 0.0011053528638331044 … 0.0011053523826827932 0.0011053524171780035; 0.0011053528638517067 0.001105352863842754 … 0.0011053524171780035 0.0011053524484369427;;; 0.001104132375968241 0.0011041323759771937 … 0.0011041328226419442 0.0011041327913830052; 0.0011041323759771937 0.0011041323759868433 … 0.0011041328571371547 0.0011041328226419442; … ; 0.0011041323759771937 0.0011041323759868433 … 0.0011041328571371547 0.0011041328226419442; 0.001104132375968241 0.0011041323759771937 … 0.0011041328226419442 0.0011041327913830052]
 [9.837734761082027e-7 1.069728314870665e-6 … 0.0014550919403635942 0.001286939535979884; 1.069728314870665e-6 1.1666270528831613e-6 … 0.0016522401555657791 0.0014550919403635942; … ; 1.069728314870665e-6 1.1666270528831613e-6 … 0.0016522401555657791 0.0014550919403635942; 9.837734761082027e-7 1.069728314870665e-6 … 0.0014550919403635942 0.001286939535979884;;; 0.0014666847725153 0.0014666847724792008 … 0.0014666837305651816 0.0014666838235512587; 0.0014666847724792008 0.0014666847724393811 … 0.0014666836249749018 0.0014666837305651816; … ; 0.0014666847724792008 0.0014666847724393811 … 0.0014666836249749018 0.0014666837305651816; 0.0014666847725153 0.0014666847724792008 … 0.0014666837305651816 0.0014666838235512587;;; 0.001464536697606192 0.0014645366976422912 … 0.0014645377395563106 0.0014645376465702335; 0.0014645366976422912 0.001464536697682111 … 0.0014645378451465904 0.0014645377395563106; … ; 0.0014645366976422912 0.001464536697682111 … 0.0014645378451465904 0.0014645377395563106; 0.001464536697606192 0.0014645366976422912 … 0.0014645377395563106 0.0014645376465702335]
 ⋮
 [0.0860980584145309 0.17043647381136437 … 0.5253487807847173 0.2653793414280966; 0.17043632607368323 0.3382712254382821 … 1.0431153649867155 0.5255803265164318; … ; 0.17043632607047352 0.338271225445665 … 1.0431153649877962 0.5255803265126668; 0.08609805841464986 0.1704364738091774 … 0.5253487807877247 0.265379341430695;;; 1.4373252284252627 1.381514056133696 … 1.1874256906452123 1.3236301768644763; 1.3815141490947984 1.282410462486958 … 0.9854451339241748 1.1873168599586519; … ; 1.3815141490947924 1.2824104624869688 … 0.9854451339241813 1.1873168599586483; 1.4373252284252602 1.3815140561336967 … 1.1874256906452232 1.3236301768644851;;; 0.5618219481395736 0.6176331204311375 … 0.8117214859196261 0.6755169997003598; 0.6176330274700377 0.7167367140778765 … 1.0137020426406604 0.811830316606183; … ; 0.6176330274700433 0.7167367140778665 … 1.0137020426406564 0.811830316606187; 0.5618219481395745 0.6176331204311389 … 0.8117214859196145 0.6755169997003496]
 [0.08611716284361551 0.17047468757767417 … 0.5254093393090755 0.265409623784774; 0.17047453796637485 0.33834765744416206 … 1.043236489945349 0.5256408960059097; … ; 0.17047453797624784 0.3383476574329872 … 1.0432364899545734 0.5256408960113826; 0.08611716284187021 0.17047468757644577 … 0.5254093392900094 0.26540962378754035;;; 1.4378006045760103 1.3819336252553542 … 1.1877342572082403 1.3240275973003055; 1.3819337199879664 1.2827436621439456 … 0.9856521249815257 1.1876253748112229; … ; 1.3819337199879878 1.282743662143918 … 0.9856521249815371 1.187625374811248; 1.4378006045760054 1.3819336252553445 … 1.1877342572081835 1.3240275973003033;;; 0.5618903141179099 0.6177572934385639 … 0.8119566614856801 0.6756633213936142; 0.6177571987059528 0.716947256549974 … 1.014038793712393 0.8120655438826948; … ; 0.6177571987059314 0.7169472565500006 … 1.014038793712381 0.812065543882672; 0.5618903141179137 0.6177572934385737 … 0.8119566614857363 0.675663321393615]
 [0.08612424653409514 0.1704888541714203 … 0.5254313531199226 0.26542063415503336; 0.17048870388305637 0.3383759883686652 … 1.0432805111692454 0.5256629133739961; … ; 0.1704887038883321 0.33837598835841554 … 1.0432805111290577 0.5256629134018219; 0.08612424653691521 0.17048885417575446 … 0.5254313531223933 0.2654206341449212;;; 1.4379761857636695 1.3820885642569618 … 1.187848575254823 1.3241746260446108; 1.3820886597402704 1.2828666720897481 … 0.9857290285709916 1.1877396740993025; … ; 1.382088659740295 1.2828666720897104 … 0.985729028570942 1.1877396740993493; 1.4379761857636821 1.3820885642569747 … 1.1878485752547856 1.3241746260445781;;; 0.5619155910916934 0.6178032125983992 … 0.81204320160054 0.675717150810749; 0.6178031171150915 0.7170251047656166 … 1.014162748284371 0.8121521027560599; … ; 0.6178031171150687 0.7170251047656533 … 1.01416274828442 0.8121521027560125; 0.5619155910916772 0.6178032125983878 … 0.8120432016005785 0.6757171508107845]
 [0.08612614504602102 0.17049265171457642 … 0.525437120686977 0.26542351832198846; 0.1704925012778496 0.33838358347625414 … 1.0432920459311534 0.5256686816812286; … ; 0.17049250125561458 0.33838358352274106 … 1.0432920462707862 0.5256686816281663; 0.08612614502946425 0.17049265174051192 … 0.5254371206311342 0.26542351827734434;;; 1.4380217482813722 1.3821288252436692 … 1.1878784162080114 1.3242128480702946; 1.382128920937962 1.282898770102663 … 0.9857493588365255 1.187769510236514; … ; 1.3821289209378955 1.2828987701027577 … 0.9857493588371241 1.1877695102364358; 1.4380217482813036 1.382128825243725 … 1.1878784162079201 1.3242128480701114;;; 0.5619220947768395 0.6178150178145437 … 0.81206542685021 0.6757309949879174; 0.6178149221202488 0.7170450729555525 … 1.0141944842216821 0.8121743328217007; … ; 0.6178149221203245 0.7170450729554643 … 1.0141944842210908 0.8121743328217819; 0.5619220947769019 0.6178150178144902 … 0.8120654268503005 0.6757309949881005]
 [0.0861263484550237 0.1704930588114406 … 0.5254376433059956 0.26542377925479826; 0.1704929083575903 0.3383843985532119 … 1.043293094769307 0.5256692044097837; … ; 0.1704929083179532 0.3383843985504839 … 1.0432930941125902 0.5256692047684617; 0.08612634841214753 0.17049305897868994 … 0.5254376437522809 0.2654237789478525;;; 1.4380264806957288 1.3821330324293595 … 1.1878815936547746 1.324216899594982; 1.3821331281547102 1.2829020891792937 … 0.9857513300943188 1.1877726872009684; … ; 1.3821331281546714 1.2829020891793919 … 0.9857513300935629 1.1877726872015324; 1.4380264806956726 1.382133032429838 … 1.1878815936554665 1.3242168995943688;;; 0.5619227864032379 0.6178162346696093 … 0.812067673444226 0.6757323675039573; 0.6178161389442847 0.7170471779196865 … 1.0141979370046275 0.8121765798980022; … ; 0.6178161389443182 0.7170471779195954 … 1.0141979370054217 0.8121765798974202; 0.561922786403297 0.61781623466914 … 0.8120676734434983 0.6757323675045981]
 [0.08612696916103961 0.1704942996211746 … 0.5254400816807748 0.26542500060545304; 0.17049414903877258 0.3383868795724996 … 1.043297975800099 0.5256716441583383; … ; 0.17049414919857298 0.33838687869515427 … 1.0432979721279094 0.5256716450098741; 0.08612696914432466 0.17049429987008752 … 0.525440082168004 0.26542500091475424;;; 1.4380418735129417 1.3821466102175435 … 1.1878911197329391 1.324229463323031; 1.3821467059253385 1.2829128644483128 … 0.9857575482619754 1.1877822109612353; … ; 1.3821467059252304 1.282912864446957 … 0.9857575482563989 1.1877822109616085; 1.4380418735133622 1.3821466102178275 … 1.1878911197332265 1.3242294633241454;;; 0.5619250181562303 0.6178202814514968 … 0.8120757719362344 0.675737428346068; 0.6178201857436643 0.7170540272208108 … 1.014209343407195 0.8121846807079487; … ; 0.6178201857438892 0.7170540272223528 … 1.014209343412782 0.8121846807075852; 0.5619250181559755 0.6178202814512223 … 0.8120757719358355 0.6757374283449257]
 [0.08612922377484898 0.17049880746230267 … 0.5254468148723012 0.26542836358957134; 0.17049865534065103 0.33839590092128835 … 1.0433114145796933 0.5256783805383086; … ; 0.17049865860770871 0.3383958958161563 … 1.0433114239576757 0.5256783777167134; 0.08612922322293583 0.17049880814212776 … 0.525446811840995 0.2654283642611259;;; 1.4380984980593468 1.382196601013655 … 1.1879282918393537 1.3242770694216377; 1.382196697047234 1.2829525933107075 … 0.9857827134840025 1.1878193774417978; … ; 1.3821966970533412 1.2829525932993169 … 0.9857827134916414 1.1878193774431431; 1.43809849805989 1.3821966010112683 … 1.1879282918325718 1.3242770694231056;;; 0.5619331295482851 0.6178350265953393 … 0.8121033357688703 0.6757545581872626; 0.6178349305618676 0.7170790342975233 … 1.0142489141247812 0.8122122501663108; … ; 0.6178349305548604 0.7170790343096268 … 1.014248914116363 0.812212250165756; 0.5619331295484676 0.6178350265969836 … 0.8121033357761148 0.675754558186087]
 [0.08612916330502197 0.17049869317371466 … 0.5254465304448525 0.2654282163618434; 0.17049854499628475 0.33839566059686466 … 1.0433108429459548 0.5256780726382269; … ; 0.17049854184749363 0.3383956617550718 … 1.0433108543112954 0.5256780602391141; 0.08612916171450978 0.17049869578421842 … 0.5254465182386399 0.2654282327286097;;; 1.438096899651587 1.3821951874950726 … 1.1879273352067259 1.324275791897684; 1.3821952836875342 1.2829514631453598 … 0.985782108932073 1.1878184210379235; … ; 1.3821952836664313 1.2829514631602468 … 0.9857821089456186 1.187818421030176; 1.4380968996444772 1.3821951874942873 … 1.187927335176687 1.3242757919422374;;; 0.5619328997439027 0.6178346119017598 … 0.8121024641884341 0.6757540074995592; 0.6178345157098714 0.7170783362480253 … 1.0142476904650342 0.8122113783598383; … ; 0.6178345157287075 0.7170783362385516 … 1.0142476904497297 0.8122113783638633; 0.5619328997500804 0.6178346119013959 … 0.8121024642139002 0.6757540074487606]
 [0.08612858502693178 0.17049753011854185 … 0.5254450995508656 0.2654275119357499; 0.17049737654539124 0.33839335967131645 … 1.0433080246587925 0.5256766560874475; … ; 0.17049739061254476 0.33839332923662874 … 1.0433080297881574 0.5256766653154703; 0.08612858461742168 0.17049753677333118 … 0.5254450841778983 0.2654275090734674;;; 1.4380834767959698 1.382183387135683 … 1.1879183611000284 1.3242643710114153; 1.3821834831479929 1.2829421711018256 … 0.9857759838047694 1.1878094482253942; … ; 1.3821834831841513 1.282942171049491 … 0.9857759838212017 1.1878094482498152; 1.4380834768058741 1.3821833871480351 … 1.18791836103523 1.324264370990561;;; 0.5619309119379512 0.6178310015967424 … 0.8120960276328201 0.6757500177235799; 0.617830905584656 0.7170722176292615 … 1.014238404929981 0.8122049405078227; … ; 0.6178309055491185 0.7170722176846236 … 1.0142384049122126 0.8122049404803533; 0.5619309119268662 0.6178310015838927 … 0.8120960276957662 0.675750017738761]</code></pre><p>if I want to solve it on <span>$t \in [0,100]$</span>. Done! The solution gives back our tensors (and interpolates to create new ones if you use sol(t)). We can plot it in Plots.jl:</p><pre><code class="language-julia hljs">using Plots
p1 = surface(X, Y, sol[end][:, :, 1], title = &quot;[A]&quot;)
p2 = surface(X, Y, sol[end][:, :, 2], title = &quot;[B]&quot;)
p3 = surface(X, Y, sol[end][:, :, 3], title = &quot;[C]&quot;)
plot(p1, p2, p3, layout = grid(3, 1))</code></pre><img src="f206aaac.svg" alt="Example block output"/><p>and see the pretty gradients. Using this 2nd order ROCK method we solve this equation in about 2 seconds. That&#39;s okay.</p><h2 id="Some-Optimizations"><a class="docs-heading-anchor" href="#Some-Optimizations">Some Optimizations</a><a id="Some-Optimizations-1"></a><a class="docs-heading-anchor-permalink" href="#Some-Optimizations" title="Permalink"></a></h2><p>There are some optimizations that can still be done. When we do A*B as matrix multiplication, we create another temporary matrix. These allocations can bog down the system. Instead, we can pre-allocate the outputs and use the inplace functions mul! to make better use of memory. The easiest way to store these cache arrays are constant globals, but you can use closures (anonymous functions which capture data, i.e. (x)-&gt;f(x,y)) or call-overloaded types to do it without globals. The globals way (the easy way) is simply:</p><pre><code class="language-julia hljs">const MyA = zeros(N, N)
const AMx = zeros(N, N)
const DA = zeros(N, N)
function f(du, u, p, t)
    A = @view u[:, :, 1]
    B = @view u[:, :, 2]
    C = @view u[:, :, 3]
    dA = @view du[:, :, 1]
    dB = @view du[:, :, 2]
    dC = @view du[:, :, 3]
    mul!(MyA, My, A)
    mul!(AMx, A, Mx)
    @. DA = D * (MyA + AMx)
    @. dA = DA + α₁ - β₁ * A - r₁ * A * B + r₂ * C
    @. dB = α₂ - β₂ * B - r₁ * A * B + r₂ * C
    @. dC = α₃ - β₃ * C + r₁ * A * B - r₂ * C
end</code></pre><p>For reference, closures looks like:</p><pre><code class="language-julia hljs">MyA = zeros(N, N)
AMx = zeros(N, N)
DA = zeros(N, N)
function f_full(du, u, p, t, MyA, AMx, DA)
    A = @view u[:, :, 1]
    B = @view u[:, :, 2]
    C = @view u[:, :, 3]
    dA = @view du[:, :, 1]
    dB = @view du[:, :, 2]
    dC = @view du[:, :, 3]
    mul!(MyA, My, A)
    mul!(AMx, A, Mx)
    @. DA = D * (MyA + AMx)
    @. dA = DA + α₁ - β₁ * A - r₁ * A * B + r₂ * C
    @. dB = α₂ - β₂ * B - r₁ * A * B + r₂ * C
    @. dC = α₃ - β₃ * C + r₁ * A * B - r₂ * C
end
f(du, u, p, t) = f_full(du, u, p, t, MyA, AMx, DA)</code></pre><p>and a call overloaded type looks like:</p><pre><code class="language-julia hljs">struct MyFunction{T} &lt;: Function
    MyA::T
    AMx::T
    DA::T
end

# Now define the overload
function (ff::MyFunction)(du, u, p, t)
    # This is a function which references itself via ff
    A = @view u[:, :, 1]
    B = @view u[:, :, 2]
    C = @view u[:, :, 3]
    dA = @view du[:, :, 1]
    dB = @view du[:, :, 2]
    dC = @view du[:, :, 3]
    mul!(ff.MyA, My, A)
    mul!(ff.AMx, A, Mx)
    @. ff.DA = D * (ff.MyA + ff.AMx)
    @. dA = f.DA + α₁ - β₁ * A - r₁ * A * B + r₂ * C
    @. dB = α₂ - β₂ * B - r₁ * A * B + r₂ * C
    @. dC = α₃ - β₃ * C + r₁ * A * B - r₂ * C
end

MyA = zeros(N, N)
AMx = zeros(N, N)
DA = zeros(N, N)

f = MyFunction(MyA, AMx, DA)
# Now f(du,u,p,t) is our function!</code></pre><p>These last two ways enclose the pointer to our cache arrays locally but still present a function f(du,u,p,t) to the ODE solver.</p><p>Now, since PDEs are large, many times we don&#39;t care about getting the whole timeseries. Using the <a href="http://diffeq.sciml.ai/latest/basics/common_solver_opts.html#Output-Control-1">output controls from DifferentialEquations.jl</a>, we can make it only output the final timepoint.</p><pre><code class="language-julia hljs">prob = ODEProblem(f, u0, (0.0, 100.0))
@time sol = solve(prob, ROCK2(), progress = true, save_everystep = false,
                  save_start = false);
@time sol = solve(prob, ROCK2(), progress = true, save_everystep = false,
                  save_start = false);</code></pre><p>Around 0.4 seconds. Much better. Also, if you&#39;re using VS Code, this&#39;ll give you a nice progress bar, so you can track how it&#39;s going.</p><h2 id="Quick-Note-About-Performance"><a class="docs-heading-anchor" href="#Quick-Note-About-Performance">Quick Note About Performance</a><a id="Quick-Note-About-Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Note-About-Performance" title="Permalink"></a></h2><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We are using the ROCK2 method here because it&#39;s a method for stiff equations with eigenvalues that are real-dominated (as opposed to dominated by the imaginary parts). If we wanted to use a more conventional implicit ODE solver, we would need to make use of the sparsity pattern. This is covered in <a href="https://docs.sciml.ai/DiffEqDocs/stable/tutorials/advanced_ode_example/">the advanced ODE tutorial</a> It turns out that ROCK2 is more efficient anyway (and doesn&#39;t require sparsity handling), so we will keep this setup.</p></div></div><h3 id="Quick-Summary:-full-PDE-ODE-Code"><a class="docs-heading-anchor" href="#Quick-Summary:-full-PDE-ODE-Code">Quick Summary: full PDE ODE Code</a><a id="Quick-Summary:-full-PDE-ODE-Code-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Summary:-full-PDE-ODE-Code" title="Permalink"></a></h3><p>As a summary, here&#39;s a full PDE code:</p><pre><code class="language-julia hljs">using OrdinaryDiffEq, LinearAlgebra

# Define the constants for the PDE
const α₂ = 1.0
const α₃ = 1.0
const β₁ = 1.0
const β₂ = 1.0
const β₃ = 1.0
const r₁ = 1.0
const r₂ = 1.0
const D = 100.0
const γ₁ = 0.1
const γ₂ = 0.1
const γ₃ = 0.1
const N = 100
const X = reshape([i for i in 1:100 for j in 1:100], N, N)
const Y = reshape([j for i in 1:100 for j in 1:100], N, N)
const α₁ = 1.0 .* (X .&gt;= 80)

const Mx = Array(Tridiagonal([1.0 for i in 1:(N - 1)], [-2.0 for i in 1:N],
                             [1.0 for i in 1:(N - 1)]))
const My = copy(Mx)
Mx[2, 1] = 2.0
Mx[end - 1, end] = 2.0
My[1, 2] = 2.0
My[end, end - 1] = 2.0

# Define the initial condition as normal arrays
u0 = zeros(N, N, 3)

const MyA = zeros(N, N);
const AMx = zeros(N, N);
const DA = zeros(N, N)
# Define the discretized PDE as an ODE function
function f(du, u, p, t)
    A = @view u[:, :, 1]
    B = @view u[:, :, 2]
    C = @view u[:, :, 3]
    dA = @view du[:, :, 1]
    dB = @view du[:, :, 2]
    dC = @view du[:, :, 3]
    mul!(MyA, My, A)
    mul!(AMx, A, Mx)
    @. DA = D * (MyA + AMx)
    @. dA = DA + α₁ - β₁ * A - r₁ * A * B + r₂ * C
    @. dB = α₂ - β₂ * B - r₁ * A * B + r₂ * C
    @. dC = α₃ - β₃ * C + r₁ * A * B - r₂ * C
end

# Solve the ODE
prob = ODEProblem(f, u0, (0.0, 100.0))
sol = solve(prob, ROCK2(), progress = true, save_everystep = false, save_start = false)

using Plots;
gr();
p1 = surface(X, Y, sol[end][:, :, 1], title = &quot;[A]&quot;)
p2 = surface(X, Y, sol[end][:, :, 2], title = &quot;[B]&quot;)
p3 = surface(X, Y, sol[end][:, :, 3], title = &quot;[C]&quot;)
plot(p1, p2, p3, layout = grid(3, 1))</code></pre><img src="4062a7fe.svg" alt="Example block output"/><h2 id="Making-Use-of-GPU-Parallelism"><a class="docs-heading-anchor" href="#Making-Use-of-GPU-Parallelism">Making Use of GPU Parallelism</a><a id="Making-Use-of-GPU-Parallelism-1"></a><a class="docs-heading-anchor-permalink" href="#Making-Use-of-GPU-Parallelism" title="Permalink"></a></h2><p>That was all using the CPU. How do we turn on GPU parallelism with DifferentialEquations.jl? Well, you don&#39;t. DifferentialEquations.jl &quot;doesn&#39;t have GPU bits&quot;. So, wait... can we not do GPU parallelism? No, this is the glory of type-genericness, especially in broadcasted operations. To make things use the GPU, we simply use a CuArray from <a href="https://cuda.juliagpu.org/stable/">CUDA.jl</a>. If instead of <code>zeros(N,M)</code> we used <code>CuArray(zeros(N,M))</code>, then the array lives on the GPU. CuArray naturally overrides broadcast such that dotted operations are performed on the GPU. DifferentialEquations.jl uses broadcast internally, and thus just by putting the array as a <code>CuArray</code>, the array-type will take over how all internal updates are performed and turn this algorithm into a fully GPU-parallelized algorithm that doesn&#39;t require copying to the CPU. Wasn&#39;t that simple?</p><p>From that you can probably also see how to multithread everything, or how to set everything up with distributed parallelism. You can make the ODE solvers do whatever you want by defining an array type where the broadcast does whatever special behavior you want.</p><p>So to recap, the entire difference from above is changing to:</p><pre><code class="language-julia hljs">using CUDA
const gMx = CuArray(Float32.(Mx))
const gMy = CuArray(Float32.(My))
const gα₁ = CuArray(Float32.(α₁))
gu0 = CuArray(Float32.(u0))

const gMyA = CuArray(zeros(Float32, N, N))
const AgMx = CuArray(zeros(Float32, N, N))
const gDA = CuArray(zeros(Float32, N, N))
function gf(du, u, p, t)
    A = @view u[:, :, 1]
    B = @view u[:, :, 2]
    C = @view u[:, :, 3]
    dA = @view du[:, :, 1]
    dB = @view du[:, :, 2]
    dC = @view du[:, :, 3]
    mul!(gMyA, gMy, A)
    mul!(AgMx, A, gMx)
    @. gDA = D * (gMyA + AgMx)
    @. dA = gDA + gα₁ - β₁ * A - r₁ * A * B + r₂ * C
    @. dB = α₂ - β₂ * B - r₁ * A * B + r₂ * C
    @. dC = α₃ - β₃ * C + r₁ * A * B - r₂ * C
end

prob2 = ODEProblem(gf, gu0, (0.0, 100.0))
CUDA.allowscalar(false) # makes sure none of the slow fallbacks are used
@time sol = solve(prob2, ROCK2(), progress = true, dt = 0.003, save_everystep = false,
                  save_start = false);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 1st order linear
t: 1-element Vector{Float64}:
 100.0
u: 1-element Vector{CUDA.CuArray{Float32, 3, CUDA.Mem.DeviceBuffer}}:
 [0.30325767 0.30234623 … 0.9336535 0.9336841; 0.30325767 0.30234623 … 0.9336535 0.9336841; … ; 0.30325767 0.30234623 … 0.9336535 0.9336841; 0.30325767 0.30234623 … 0.9336535 0.9336841;;; 1.3027548 1.302752 … 1.0227438 1.0225888; 1.3027548 1.302752 … 1.0227438 1.0225888; … ; 1.3027548 1.302752 … 1.0227438 1.0225888; 1.3027548 1.302752 … 1.0227438 1.0225888;;; 0.69724476 0.697248 … 0.977256 0.97741115; 0.69724476 0.697248 … 0.977256 0.97741115; … ; 0.69724476 0.697248 … 0.977256 0.97741115; 0.69724476 0.697248 … 0.977256 0.97741115]</code></pre><pre><code class="language-julia hljs">@time sol = solve(prob2, ROCK2(), progress = true, dt = 0.003, save_everystep = false,
                  save_start = false);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 1st order linear
t: 1-element Vector{Float64}:
 100.0
u: 1-element Vector{CUDA.CuArray{Float32, 3, CUDA.Mem.DeviceBuffer}}:
 [0.30325767 0.30234623 … 0.9336535 0.9336841; 0.30325767 0.30234623 … 0.9336535 0.9336841; … ; 0.30325767 0.30234623 … 0.9336535 0.9336841; 0.30325767 0.30234623 … 0.9336535 0.9336841;;; 1.3027548 1.302752 … 1.0227438 1.0225888; 1.3027548 1.302752 … 1.0227438 1.0225888; … ; 1.3027548 1.302752 … 1.0227438 1.0225888; 1.3027548 1.302752 … 1.0227438 1.0225888;;; 0.69724476 0.697248 … 0.977256 0.97741115; 0.69724476 0.697248 … 0.977256 0.97741115; … ; 0.69724476 0.697248 … 0.977256 0.97741115; 0.69724476 0.697248 … 0.977256 0.97741115]</code></pre><p>Go have fun.</p><h2 id="And-Stochastic-PDEs?"><a class="docs-heading-anchor" href="#And-Stochastic-PDEs?">And Stochastic PDEs?</a><a id="And-Stochastic-PDEs?-1"></a><a class="docs-heading-anchor-permalink" href="#And-Stochastic-PDEs?" title="Permalink"></a></h2><p>Why not make it an SPDE? All that we need to do is extend each of the PDE equations to have a noise function. In this case, let&#39;s use multiplicative noise on each reactant. This means that our noise update equation is:</p><pre><code class="language-julia hljs">function g(du, u, p, t)
    A = @view u[:, :, 1]
    B = @view u[:, :, 2]
    C = @view u[:, :, 3]
    dA = @view du[:, :, 1]
    dB = @view du[:, :, 2]
    dC = @view du[:, :, 3]
    @. dA = γ₁ * A
    @. dB = γ₂ * A
    @. dC = γ₃ * A
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">g (generic function with 1 method)</code></pre><p>Now we just define and solve the system of SDEs:</p><pre><code class="language-julia hljs">prob = SDEProblem(f, g, u0, (0.0, 100.0))
@time sol = solve(prob, SRIW1());</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 1st order linear
t: 81508-element Vector{Float64}:
   0.0
   9.999999999999999e-5
   0.0002125
   0.00033906249999999995
   0.0004814453125
   0.0006416259765625
   0.0008218292236328125
   0.0010245578765869141
   0.0012526276111602785
   0.0015092060625553133
   ⋮
  99.98110670925011
  99.98279332098247
  99.98469075918136
  99.98682537715513
  99.98922682237561
  99.99192844824866
  99.99496777735584
  99.9983870226014
 100.0
u: 81508-element Vector{Array{Float64, 3}}:
 [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0;;; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0;;; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]
 [4.999999999999999e-9 4.999999999999999e-9 … 9.997611341417575e-5 9.89149676400763e-5; 4.999999999999999e-9 4.999999999999999e-9 … 0.0001009988699036398 9.991442233983692e-5; … ; 4.999999999999999e-9 4.999999999999999e-9 … 0.00010101212167933368 0.00010010698221893377; 4.999999999999999e-9 4.999999999999999e-9 … 0.0001000334039463716 9.907989332432137e-5;;; 9.999999999999999e-5 9.999999999999999e-5 … 9.998843471607841e-5 0.00010008858120527069; 9.999999999999999e-5 9.999999999999999e-5 … 0.00010005002852266639 0.00010007016437403299; … ; 9.999999999999999e-5 9.999999999999999e-5 … 9.994963129405111e-5 9.986205621016959e-5; 9.999999999999999e-5 9.999999999999999e-5 … 0.00010005345374766784 9.983910170605524e-5;;; 9.999e-5 9.999e-5 … 9.999021409717838e-5 9.994851938109255e-5; 9.999e-5 9.999e-5 … 0.00010000476292997629 9.994283712748151e-5; … ; 9.999e-5 9.999e-5 … 9.995833059611618e-5 9.999103301086109e-5; 9.999e-5 9.999e-5 … 0.00010006818331826978 0.00010013310823309601]
 [2.2339599313608878e-8 2.256057580606695e-8 … 0.00021264972727751743 0.00020800734284515384; 2.2587151331635297e-8 2.2809769625511375e-8 … 0.00021673723394620588 0.00021210776441755777; … ; 2.257666350066324e-8 2.28148424535029e-8 … 0.00021712268972095977 0.00021279600833344113; 2.233131546230762e-8 2.257794545808422e-8 … 0.00021243412035314098 0.00020826603193999104;;; 0.00021249999400390384 0.000212500010999673 … 0.00021277288988482204 0.00021242392587233686; 0.00021250000213880832 0.0002125000085757704 … 0.00021244009143375482 0.00021274898842426655; … ; 0.0002125000087604787 0.0002124999806413825 … 0.0002124826191056819 0.0002127067882994282; 0.00021249998840983437 0.00021249999119890377 … 0.000212787338491658 0.00021215324407613623;;; 0.0002124548423063653 0.0002124548526154893 … 0.00021201321734600298 0.00021243406323492926; 0.00021245488078174202 0.00021245487061684746 … 0.0002124745937945766 0.00021244897297450235; … ; 0.00021245484578665165 0.0002124548551119404 … 0.00021233675238824956 0.00021246696155531732; 0.0002124548535172263 0.00021245486412822264 … 0.00021227898259855015 0.0002128156439369318]
 [5.6262872773996106e-8 5.7470370119309954e-8 … 0.00033869318145360474 0.0003274196034989499; 5.743178189460268e-8 5.865166521631887e-8 … 0.0003502199793161283 0.00033827311941809395; … ; 5.750705464185065e-8 5.868221528578267e-8 … 0.0003504595108994533 0.0003389354174178726; 5.631752038835832e-8 5.750092079078216e-8 … 0.0003389604381792101 0.00032800802413292485;;; 0.00033906250668263774 0.00033906251884930125 … 0.000339438837124405 0.0003389648826267802; 0.0003390625286990877 0.0003390624816528745 … 0.00033957994048137004 0.0003392293512101851; … ; 0.00033906251424506043 0.00033906241924133994 … 0.00033989596943819617 0.0003395888450350092; 0.00033906243684831056 0.0003390625328615222 … 0.00033900200053632514 0.00033854306547517965;;; 0.00033894744857054825 0.00033894756705836964 … 0.0003388878114827745 0.00033901643530832707; 0.00033894761493008746 0.00033894756704403253 … 0.00033853482923868237 0.00033918293884671494; … ; 0.00033894757304988937 0.00033894757316268326 … 0.0003391567466572994 0.00033918665515513446; 0.0003389475284850295 0.00033894760310191724 … 0.00033870084531967314 0.0003389346669903404]
 [1.1252593301581522e-7 1.156068378479483e-7 … 0.00048051130677881143 0.0004600814528429001; 1.1584758016065627e-7 1.1919426668832573e-7 … 0.0005041783755395522 0.00048088800401448965; … ; 1.1592985156837508e-7 1.1905650602185219e-7 … 0.0005035869301089302 0.00048053992997567073; 1.1252344525622102e-7 1.1592871894664566e-7 … 0.0004818619527729917 0.00045985036863327753;;; 0.00048144514523450145 0.0004814453055462488 … 0.00048171528270464633 0.0004811438479355386; 0.00048144531069844684 0.0004814452927490606 … 0.00048286832259097494 0.0004817494681516282; … ; 0.0004814452503157208 0.0004814451637727446 … 0.00048271899975975196 0.00048176912634841047; 0.000481445162680556 0.00048144525726015415 … 0.00048145419492009854 0.0004809590113224046;;; 0.0004812134562528226 0.0004812134952685234 … 0.0004811313757915659 0.0004818918754255418; 0.0004812136182444423 0.0004812135779754735 … 0.0004809513210377338 0.0004821182046242496; … ; 0.0004812136596051494 0.00048121364432176063 … 0.0004818659649591767 0.00048037660120061666; 0.0004812135984534011 0.00048121375145642777 … 0.00048117758137136094 0.0004806177714415578]
 [1.98099071410299e-7 2.0539756865581316e-7 … 0.0006400132846043831 0.000604840189627761; 2.055289893015414e-7 2.1358404555388736e-7 … 0.0006793546820209177 0.0006400461964315565; … ; 2.0571187184554902e-7 2.1367028876320394e-7 … 0.0006803788311776071 0.0006413803668869926; 1.9798339611980258e-7 2.0534189819007188e-7 … 0.0006411508635119324 0.0006044109536402437;;; 0.0006416256590754056 0.000641625638245803 … 0.00064186653473072 0.0006415553929841135; 0.0006416259702152896 0.0006416258352733923 … 0.0006437447938361622 0.000640967856999142; … ; 0.0006416257013664843 0.0006416255212276288 … 0.0006430174947395187 0.0006439333841072826; 0.0006416258920108351 0.0006416260209043093 … 0.0006414955906738192 0.0006407278401351625;;; 0.0006412142442750056 0.0006412143754063982 … 0.0006418772875122963 0.0006430994047231003; 0.0006412143613116282 0.0006412143972859137 … 0.0006411420633037761 0.0006430083484375037; … ; 0.0006412145838549414 0.000641214373545053 … 0.0006415141388569288 0.000640455332954266; 0.000641214063889499 0.0006412146866682815 … 0.0006416319670607326 0.0006410701559738785]
 [3.211096089022958e-7 3.3644866208700647e-7 … 0.0008204161983403519 0.0007614436400025396; 3.373253218837809e-7 3.5415174843515017e-7 … 0.0008821378898180611 0.0008205324967237015; … ; 3.3722858723607075e-7 3.548368832143064e-7 … 0.0008845034525708495 0.0008205130474934324; 3.2108191467955587e-7 3.366515141183701e-7 … 0.000819922619289074 0.0007617693962061649;;; 0.000821828352341834 0.0008218293310259461 … 0.0008216695098910881 0.0008222614894838176; 0.0008218294531083724 0.0008218296181757726 … 0.0008254131156835409 0.0008243609105960822; … ; 0.0008218287127430529 0.0008218282762170215 … 0.0008239099077978166 0.00082442265495853; 0.0008218294223114412 0.000821829393480004 … 0.0008208900691006603 0.0008199813774684412;;; 0.0008211540165403314 0.0008211540809519246 … 0.000821538513441437 0.0008220628192423999; 0.0008211543842739118 0.0008211538155965646 … 0.0008209884922824503 0.0008226175477138185; … ; 0.0008211544526886554 0.0008211537333865256 … 0.0008217362781282579 0.0008203479544216942; 0.0008211537301734117 0.0008211542103386827 … 0.0008220016935715076 0.0008191867562883568]
 [4.928108144460494e-7 5.231231965335091e-7 … 0.0010200512599306325 0.0009321815068958671; 5.239758312478387e-7 5.562475714712459e-7 … 0.001118898593479491 0.001021894827413437; … ; 5.233897374521528e-7 5.562912366056428e-7 … 0.001119743981936056 0.0010230769986886914; 4.917571693990856e-7 5.233033972760648e-7 … 0.0010184847753413097 0.0009335670223480236;;; 0.0010245573339649518 0.0010245574394912727 … 0.0010241436963791045 0.0010268288672501096; 0.001024557717624607 0.0010245586394227256 … 0.0010290849742185639 0.001025904458972786; … ; 0.0010245578675950296 0.0010245571829278685 … 0.0010277956007669912 0.0010289847419245638; 0.0010245582793977652 0.0010245578323138083 … 0.001022436624648094 0.0010232350170781583;;; 0.0010235078778788676 0.0010235083587265775 … 0.0010235204612312214 0.0010258175904475765; 0.0010235091354911716 0.001023508787688434 … 0.0010224774732312358 0.0010253321217006046; … ; 0.0010235084983293953 0.0010235080437230371 … 0.0010251041802705418 0.001021460206545134; 0.0010235085091921767 0.0010235089297722366 … 0.0010254776777916033 0.001022847654529336]
 [7.270856000617752e-7 7.82184167699613e-7 … 0.0012480419623874177 0.0011180011955868364; 7.820939700516478e-7 8.429280345554553e-7 … 0.001390385795872111 0.0012473809688514441; … ; 7.818131980451267e-7 8.416661881219181e-7 … 0.0013916901357808736 0.0012479428516087036; 7.258846307815237e-7 7.811821305265631e-7 … 0.001245969075974729 0.0011182042606578317;;; 0.0012526271156569893 0.0012526284955253638 … 0.0012536122019789222 0.0012564379618501692; 0.0012526276766937677 0.001252628514868447 … 0.0012559890356801154 0.0012513733829675204; … ; 0.0012526261659437717 0.0012526261283836086 … 0.001257486977726582 0.0012591370093981236; 0.0012526284284642085 0.0012526273601671132 … 0.0012500170780845932 0.0012525731961822808;;; 0.0012510575070125603 0.0012510602087898242 … 0.0012489440774923375 0.0012520825440379944; 0.0012510594981042468 0.0012510585182836846 … 0.0012501778058542773 0.0012533681050150725; … ; 0.001251061325789888 0.0012510587195352456 … 0.0012548970092347716 0.0012498460480852966; 0.0012510587802122017 0.0012510601584020619 … 0.001251674871396181 0.0012475220603579316]
 [1.0366020095891971e-6 1.1331414161030012e-6 … 0.001499007363165907 0.001321772266607625; 1.1337401597809374e-6 1.239410803206042e-6 … 0.0017056700256496526 0.001500855980808063; … ; 1.132237933643254e-6 1.2347459197183083e-6 … 0.0017023717020838824 0.0015000796995951007; 1.0401236704633985e-6 1.135373272078576e-6 … 0.0014935520187726787 0.0013225239885056965;;; 0.0015092066876686273 0.0015092078815800315 … 0.0015146828339923542 0.0015123930439785546; 0.0015092035141303106 0.0015092089590992076 … 0.0015108172359941728 0.001508232978874772; … ; 0.0015092038743070718 0.0015092045899864777 … 0.001513749511944313 0.001515943532460176; 0.001509205518838254 0.001509203360270957 … 0.0015076416223754627 0.0015123628969964003;;; 0.0015069300284241444 0.001506932372093772 … 0.0015041158964000049 0.0015093604462717387; 0.0015069299025187819 0.0015069259913132404 … 0.001508831441943053 0.0015064399965252534; … ; 0.0015069289205523334 0.0015069270632244002 … 0.0015116177121676708 0.0015080530427758333; 0.0015069287781862336 0.0015069295120728266 … 0.0015087592819088352 0.001501785100280158]
 ⋮
 [0.09219408619319569 0.18239877978037008 … 0.5301391617586462 0.2650480526249432; 0.18264991764074795 0.3623739164750721 … 1.049664871129419 0.5249313900846974; … ; 0.17210134214654385 0.3419683843676285 … 1.0975966594470739 0.5516522177477365; 0.08710777801542227 0.17235462312207603 … 0.5528943686401395 0.2795732295594642;;; 1.4122228442923035 1.3883602667261161 … 1.1457910038740144 1.2353852977938171; 1.2991843683044502 1.3514064564013468 … 0.7244421715615104 1.2292973788709003; … ; 1.416961411438749 1.2648379988774399 … 1.8396934378260166 1.3562953949613008; 1.4693766930218601 1.4546793428815132 … 1.1722104297055054 1.3441077298587119;;; 0.6166449874837072 0.687714087164465 … 0.7980563858399841 0.6978063458539064; 0.6441177631216366 0.7350865191206667 … 0.689158124878292 0.7625057561896703; … ; 0.6094439754860403 0.6312451534107189 … 1.9163785136844544 0.8804465606401612; 0.5665779913701272 0.5468904737509039 … 0.7090413700982835 0.6361010670915865]
 [0.09218149451949434 0.1816889389444725 … 0.5313593398460106 0.26631347213999623; 0.18208857036740198 0.36059871819992395 … 1.0516837888747557 0.5248400448751269; … ; 0.17230631207300126 0.34127671281272876 … 1.1021870766940427 0.5543043395099675; 0.08746310878736183 0.17337955439059058 … 0.5521902601328831 0.2788887614010069;;; 1.4118364673188706 1.3889890300232728 … 1.1480741121059397 1.2370500946948124; 1.2982525017117545 1.355226780908961 … 0.7221838793015417 1.2320297593753238; … ; 1.4171026298459142 1.26500133665244 … 1.831536539587463 1.358678992322629; 1.469408443680162 1.4538050136328313 … 1.171681783056763 1.3429672042710208;;; 0.6169186531776935 0.6867900580302047 … 0.7967101311889682 0.6953637721702011; 0.6432478974875587 0.7377742329285623 … 0.6930005624563096 0.7620385196930403; … ; 0.6098169635720955 0.6298812691454381 … 1.9062172641880888 0.8787990650058585; 0.5670867196825407 0.5461437730927007 … 0.7088457145983734 0.6364153367154748]
 [0.09172566573966036 0.18066601940348692 … 0.5294102891677313 0.2654079755425129; 0.18085081234406566 0.3587594899212395 … 1.0543968611658736 0.5244708830315543; … ; 0.17178713574276683 0.3398499262354775 … 1.0946696989214866 0.5548912552229512; 0.0871629976507824 0.17302185452667687 … 0.5505098042606794 0.27794329017805125;;; 1.4122095809346336 1.3896932328157463 … 1.1482567525052951 1.2371469002322468; 1.2986759877220009 1.3562176325519217 … 0.7388329003831126 1.23167085670033; … ; 1.4173739664727467 1.26519303751393 … 1.8255619873352178 1.3601385501306944; 1.4688104700091862 1.452328703563001 … 1.1677769512687428 1.3423139259740526;;; 0.6171324062003991 0.6876318030559494 … 0.7951024488326647 0.695792443725314; 0.6423342351745391 0.7388120762701039 … 0.7032339794303701 0.7661637761664489; … ; 0.6095032844922371 0.6301335241445957 … 1.9045294634985799 0.8777157931512105; 0.5670226344621934 0.5466644612405717 … 0.7109948570510287 0.6376313279202949]
 [0.09140157422532148 0.1814485938574806 … 0.5297636503523198 0.2660450509379822; 0.18036865272773317 0.35732738653874363 … 1.057749356239299 0.5277169460731754; … ; 0.17191448177149635 0.3418069897747672 … 1.093781074529448 0.555196499667569; 0.08671294885601799 0.17345844864565316 … 0.5514972039945532 0.27803475090425644;;; 1.4126648564944104 1.390111105578803 … 1.1494184228190782 1.2394544201915145; 1.298697598992667 1.3579600926009392 … 0.7350664169384794 1.2319567153861413; … ; 1.416813014798647 1.2654740546506122 … 1.8174746134557516 1.3597407770030625; 1.4687881530906013 1.4506486895417343 … 1.1695403923421337 1.3429315648033229;;; 0.6174326475644754 0.6878359478918052 … 0.7974748633390026 0.6952856008620892; 0.6424649898528945 0.7401718205055323 … 0.7003485416106844 0.7640827073848716; … ; 0.6084599988861493 0.6326785827763306 … 1.9132470691699297 0.8768419674303266; 0.5666122268389655 0.5452000659869422 … 0.7078222352268174 0.6370656507724617]
 [0.09107045724274185 0.18056087132508605 … 0.5314982405946823 0.2695417587577266; 0.17979001779460438 0.3572027237819593 … 1.0580520964892415 0.5283113715651873; … ; 0.17236492086719887 0.3421525393932584 … 1.0939368494283377 0.5574517430952377; 0.0869080029020221 0.17395307420077455 … 0.5502692085358526 0.27929773612953;;; 1.4127090072082908 1.3899432837689298 … 1.1447478208180975 1.2408531288566569; 1.2985818513588994 1.3605092576440823 … 0.7425108343924673 1.2323229944634657; … ; 1.41666738088062 1.2674359640924713 … 1.8158349250446486 1.3585602174236688; 1.4682268941687153 1.4527964842014736 … 1.1661988424939254 1.3425786530471202;;; 0.6168215056539215 0.6874969415039184 … 0.7963128373675807 0.6951743204153022; 0.6424882412090734 0.7418887924583004 … 0.7018529060627762 0.7632864798412058; … ; 0.6080303792183752 0.6339403011159329 … 1.9147615279195032 0.8762582119685208; 0.5663710093780551 0.5454242962346532 … 0.7109863847940991 0.6379194132819446]
 [0.09088861893786761 0.1792461935342207 … 0.5388975105203332 0.2713010221949428; 0.18012463640935927 0.357889082542152 … 1.0711100178609325 0.5362762881135354; … ; 0.17235286565791047 0.34148091136349124 … 1.0957129399328838 0.5520796537561902; 0.08664349216977628 0.17268502190658166 … 0.5478404288908365 0.27837646996863974;;; 1.413449241289077 1.389987002095109 … 1.1486977965838234 1.2401250905400063; 1.2991622841615538 1.357571622610742 … 0.7429739599908491 1.2318190861798124; … ; 1.4174622478719554 1.2651586121760596 … 1.814813081934108 1.349810976015725; 1.4680288867486813 1.4522453449943213 … 1.167853733435604 1.345197974163812;;; 0.61677519824309 0.6875200797531918 … 0.7946550621955288 0.6947795590865388; 0.6431326817664754 0.7410656211984658 … 0.6974126140577075 0.7591015913789972; … ; 0.608509132436785 0.6338442654482493 … 1.9152383407555036 0.8760617605910574; 0.5665799708720316 0.5435581699518792 … 0.7113039322088482 0.6386472388316837]
 [0.09046080043929819 0.17786197397184778 … 0.539936796232301 0.27170270021369736; 0.17924786293861675 0.35818879033810547 … 1.0709001074088198 0.5343392538269668; … ; 0.17249934673554612 0.3405414655845715 … 1.090481412378255 0.5504405545636725; 0.08635927553487496 0.17283226426036902 … 0.5495334714720262 0.27920078946312266;;; 1.413820015214853 1.390955743932464 … 1.1457044656191262 1.2397284949071674; 1.3006811371998848 1.3575964436250614 … 0.7443050365875006 1.2326398231462823; … ; 1.4183915877227442 1.2626994290224982 … 1.8133469050051816 1.3514518600903926; 1.4675927485091662 1.451619920757049 … 1.1692484172397346 1.342758331363869;;; 0.6159773851790629 0.6854611369999937 … 0.8008775547294165 0.6953457831101287; 0.6427270972363862 0.7402419784201445 … 0.6992967690781297 0.7627566346657176; … ; 0.6090998403055444 0.6330888128880816 … 1.9142450582291852 0.873495636351541; 0.5669420439070855 0.5428103679045625 … 0.7129323368521414 0.6393846471882326]
 [0.0904865937772021 0.1769823572338053 … 0.5404558114264428 0.27339596485198553; 0.17796942548361222 0.35795355377256005 … 1.0708164609059618 0.535773942906436; … ; 0.1721627874239398 0.3394870427494396 … 1.0935563103533381 0.547368025243705; 0.08625412828494873 0.17239022635017087 … 0.5441481969848182 0.27923969481604227;;; 1.4143438296615718 1.3894200715208167 … 1.1432547080995494 1.2398420631290539; 1.3031985556418486 1.3572164797093198 … 0.7404487354558114 1.2321533723588833; … ; 1.4176065665441153 1.266328969935258 … 1.8077148897695599 1.3475148347555133; 1.467886401666892 1.451985360810718 … 1.1603485611962843 1.343626335935087;;; 0.6154927470013346 0.6841826545520284 … 0.7961938453273252 0.6922018047836286; 0.6422461728867804 0.7426651221806382 … 0.7021090861838494 0.7661998089810267; … ; 0.6083328332637968 0.6326055549971465 … 1.917568323700344 0.8740252410186329; 0.5671590596143956 0.5420743306809609 … 0.710228853036879 0.6407975030234325]
 [0.09043706392507056 0.17930635157562147 … 0.5418703094659436 0.27161541968173963; 0.17790414751163233 0.3563754809955496 … 1.074366116356781 0.5367916154251714; … ; 0.17157251452287806 0.3403126856103448 … 1.0945694872162273 0.5489406880839229; 0.08615171774087466 0.17206909538227758 … 0.5453155607752158 0.2768465518666279;;; 1.4147422245069539 1.3898065079319417 … 1.1446523476026955 1.240363726148226; 1.303815047446343 1.3558281371704761 … 0.734283556253552 1.2310570749752672; … ; 1.4174263179789468 1.2655465014885432 … 1.8045825427801652 1.348940979676107; 1.4678261231581649 1.4505064904461178 … 1.1599728856707219 1.342516260958036;;; 0.6152704156654527 0.6843196895459548 … 0.7989301452974387 0.6921327919707795; 0.6406150956843916 0.741920432055631 … 0.6990237156548259 0.766787409411662; … ; 0.6077778359356542 0.6333100585164549 … 1.916898197638281 0.8754617550849979; 0.5666716891779381 0.5421099042235109 … 0.7147136255349928 0.6412867905241864]</code></pre><pre><code class="language-julia hljs">using Plots;
gr();

# Use `Array` to transform the result back into a CPU-based `Array` for plotting
p1 = surface(X, Y, Array(sol[end][:, :, 1]), title = &quot;[A]&quot;)
p2 = surface(X, Y, Array(sol[end][:, :, 2]), title = &quot;[B]&quot;)
p3 = surface(X, Y, Array(sol[end][:, :, 3]), title = &quot;[C]&quot;)
plot(p1, p2, p3, layout = grid(3, 1))</code></pre><img src="b69cc0e1.svg" alt="Example block output"/><p>We can see the cool effect that diffusion dampens the noise in [A] but is unable to dampen the noise in [B] which results in a very noisy [C]. The stiff SPDE takes much longer to solve even using high order plus adaptivity because stochastic problems are just that much more difficult (current research topic is to make new algorithms for this!). It gets GPU&#39;d just by using CuArray like before. But there we go: solving systems of stochastic PDEs using high order adaptive algorithms with within-method GPU parallelism. That&#39;s gotta be a first? The cool thing is that nobody ever had to implement the GPU-parallelism either, it just exists by virtue of the Julia type system.</p><p>(Note: We can also use one of the SROCK methods for better performance here, but they will require a choice of dt. This is left to the reader to try.)</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This can take a while to solve! An explicit Runge-Kutta algorithm isn&#39;t necessarily great here, though to use a stiff solver on a problem of this size requires once again smartly choosing sparse linear solvers. The high order adaptive method is pretty much necessary though, since something like Euler-Maruyama is simply not stable enough to solve this at a reasonable dt. Also, the current algorithms are not so great at handling this problem. Good thing there&#39;s a publication coming along with some new stuff...</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../massively_parallel_gpu/">« Massively Data-Parallel ODE Solving on GPUs</a><a class="docs-footer-nextpage" href="../ode_types/">Automatic Uncertainty Quantification, Arbitrary Precision, and Unit Checking in ODE Solutions using Julia&#39;s Type System »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.1 on <span class="colophon-date" title="Tuesday 17 October 2023 07:30">Tuesday 17 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
